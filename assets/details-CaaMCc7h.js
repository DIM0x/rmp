import{j as e,B as z,aj as W,ak as oe,av as G,t as v,aw as ce,x as de,D as ue,G as Z,M as K,H as Y,J as $,L as ee,O as te,N as D}from"./chakra-BSDUEdZw.js";import{c as P,e as A,aP as pe,X as he,aQ as ge,aI as me,x as E,y as w,q as I,aF as O,L as ne,p as fe,V as _,aR as B,w as L,S as xe,a3 as ye,a4 as be,k as U,o as se,D as F,aJ as J,aM as Se,aS as je,aT as we,aU as Ae}from"./index-BlrOxuFF.js";import{u as R,b as c}from"./react-BsdiJPLR.js";import{s as H}from"./master-manager-CpVnb667.js";import{C as Ce,c as Ne,a as Ee,b as Te}from"./change-type-modal-BhWGhEJH.js";import{l as ve,L as Le}from"./tools-CY-28IsV.js";import{u as q}from"./useEvent-CZUYpih_.js";import{m as Pe}from"./misc-nodes-Brr5FFDB.js";function Re(){const{t:s}=R(),a=P(),{selected:h}=A(r=>r.runtime),d=c.useRef(window.graph),o=r=>{if(d.current.hasNode(r)){const l=d.current.getNodeAttributes(r),g=l.type;return r.startsWith("stn")?l[g].names.join("/"):g}else if(d.current.hasEdge(r)){const[l,g]=d.current.extremities(r),p=d.current.getSourceAttributes(r),m=d.current.getTargetAttributes(r),j=p.type,S=m.type;return(l.startsWith("stn")?p[j].names[0]:j)+" - "+(g.startsWith("stn")?m[S].names[0]:S)}},[i,t]=c.useState([]);c.useEffect(()=>{t(["station","misc-node","line"])},[h]);const[n,u]=c.useState(!1);return e.jsxs(z,{children:[e.jsxs(W,{as:"h5",size:"sm",children:[s("panel.details.multipleSelection.selected")," ",h.size]}),e.jsxs(oe,{m:"var(--chakra-space-1)",children:[e.jsxs(G,{w:"100%",children:[e.jsx(W,{as:"h5",size:"xs",w:"100%",children:s("panel.details.multipleSelection.show")}),e.jsx(pe,{selections:[{label:s("panel.details.multipleSelection.station"),value:"station"},{label:s("panel.details.multipleSelection.miscNode"),value:"misc-node"},{label:s("panel.details.multipleSelection.edge"),value:"line"}],defaultValue:i,multiSelect:!0,onChange:r=>t(r)})]}),i.length!==0&&e.jsxs(e.Fragment,{children:[e.jsxs(v,{width:"100%",size:"sm",onClick:()=>u(!0),children:[s("panel.details.multipleSelection.change"),e.jsx(ce,{label:s("header.settings.pro"),children:e.jsx(de,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]}),e.jsx(ue,{})]}),[...h].filter(r=>i.includes("station")||!r.startsWith("stn")).filter(r=>i.includes("misc-node")||!r.startsWith("misc")).filter(r=>i.includes("line")||!r.startsWith("line")).map(r=>{var l;return e.jsxs(G,{width:"100%",children:[e.jsx(v,{width:"100%",size:"sm",variant:"solid",onClick:()=>a(he(new Set([r]))),overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:(l=o(r))==null?void 0:l.replaceAll("\n","⏎")}),e.jsx(v,{size:"sm",onClick:()=>a(me(r)),children:e.jsx(ge,{})})]},r)})]}),e.jsx(Ce,{isOpen:n,onClose:()=>u(!1),isSelect:!0,filter:i})]})}function ke(){var V,X;const{i18n:s,t:a}=R(),h=P(),d=c.useCallback(()=>{h(E()),h(w(u.current.export()))},[h,E,w]),{preference:{autoParallel:o}}=A(b=>b.app),{selected:i,theme:t}=A(b=>b.runtime),[n]=i,u=c.useRef(window.graph),[r,l]=c.useState(!1),g=c.useRef(null),p=Object.fromEntries(Object.entries(I).map(([b,le])=>[b,a(le.metadata.displayName).toString()])),[m,j]=c.useState(u.current.getEdgeAttribute(n,"type")),[S,y]=c.useState(void 0),x=Object.fromEntries((X=(V=ve[s.language])==null?void 0:V.map(b=>[b,a(O[b].metadata.displayName).toString()]))!=null?X:[]),[f,C]=c.useState(u.current.getEdgeAttribute(n,"style")),[N,T]=c.useState(void 0);c.useEffect(()=>{j(u.current.getEdgeAttribute(n,"type")),C(u.current.getEdgeAttribute(n,"style"))},[n]);const k=Object.values(ne).filter(b=>!O[f].metadata.supportLinePathType.includes(b)),ae=Object.values(fe).filter(b=>!O[b].metadata.supportLinePathType.includes(m)),ie=()=>{S&&(Ne(u.current,n,S,o),j(u.current.getEdgeAttribute(n,"type")),d())},re=()=>{N&&(Ee(u.current,n,N,t),C(u.current.getEdgeAttribute(n,"style")),d())},M=b=>{b&&(S?(ie(),y(void 0)):N&&(re(),T(void 0))),l(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(_,{label:a("panel.details.info.linePathType"),minW:"276",children:e.jsx(B,{options:p,disabledOptions:k,defaultValue:m,value:m,onChange:({target:{value:b}})=>{y(b),l(!0)}})}),e.jsx(_,{label:a("panel.details.info.lineStyleType"),minW:"276",children:e.jsx(B,{options:x,disabledOptions:ae,defaultValue:f,value:f,onChange:({target:{value:b}})=>{T(b),l(!0)}})}),e.jsx(Le,{type:"line",expand:!0}),e.jsx(Z,{isOpen:r,leastDestructiveRef:g,onClose:()=>M(!1),children:e.jsx(K,{children:e.jsxs(Y,{children:[e.jsx($,{children:a("warning")}),e.jsx(ee,{children:a("panel.details.changeLineTypeContent")}),e.jsxs(te,{children:[e.jsx(v,{ref:g,onClick:()=>M(!1),children:a("cancel")}),e.jsx(v,{ml:"2",colorScheme:"red",onClick:()=>M(!0),children:a("panel.details.changeType")})]})]})})})]})}function Oe(){const{t:s}=R(),a=P(),h=c.useCallback(()=>{a(L()),a(w(t.current.export()))},[a,L,w]),{selected:d,refresh:{nodes:o}}=A(x=>x.runtime),[i]=d,t=c.useRef(window.graph),[n,u]=c.useState(!1),r=c.useRef(null),[l,g]=c.useState(void 0),[p,m]=c.useState(xe.ShmetroBasic);c.useEffect(()=>{if(i!=null&&i.startsWith("stn")){const x=t.current.getNodeAttribute(i,"type");m(x)}},[o,d]);const j=Object.fromEntries(Object.entries(H).map(([x,f])=>[x,s(f.metadata.displayName).toString()])),S=()=>{l&&(Te(t.current,i,l),h())},y=x=>{x&&S(),g(void 0),u(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(_,{label:s("panel.details.info.stationType"),minW:"276",children:e.jsx(B,{options:j,disabledOptions:[p],value:p,onChange:({target:{value:x}})=>{g(x),u(!0)}})}),e.jsx(Z,{isOpen:n,leastDestructiveRef:r,onClose:()=>y(!1),children:e.jsx(K,{children:e.jsxs(Y,{children:[e.jsx($,{children:s("warning")}),e.jsx(ee,{children:s("panel.details.changeStationTypeContent")}),e.jsxs(te,{children:[e.jsx(v,{ref:r,onClick:()=>y(!1),children:s("cancel")}),e.jsx(v,{ml:"2",colorScheme:"red",onClick:()=>y(!0),children:s("panel.details.changeType")})]})]})})})]})}function We(){const{t:s}=R(),a=P(),h=c.useCallback(()=>{a(L()),a(E()),a(w(n.current.export()))},[a,L,E,w]),{activeSubscriptions:d}=A(p=>p.account),{selected:o,count:{parallel:i}}=A(p=>p.runtime),[t]=o,n=c.useRef(window.graph),u=p=>{const m=Math.min(Math.max(p,-10),10);n.current.hasNode(t)&&n.current.setNodeAttribute(t,"zIndex",m),n.current.hasEdge(t)&&n.current.setEdgeAttribute(t,"zIndex",m),h()},r=(p,m)=>{let j=-1;if(p){const S=n.current.getEdgeAttributes(t),[y,x]=n.current.extremities(t);j=se(n.current,S.type,y,x,m)}l(j)},l=p=>{n.current.setEdgeAttribute(t,"parallelIndex",p),a(E()),a(w(n.current.export()))},g=[];if(o.size!==0)if(o.size===1){if(g.push({type:"input",label:s("panel.details.info.id"),value:t,minW:276}),g.push({type:"select",label:s("panel.details.info.zIndex"),value:t?n.current.hasNode(t)?n.current.getNodeAttribute(t,"zIndex"):n.current.hasEdge(t)?n.current.getEdgeAttribute(t,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:21},(p,m)=>[m-10,(m-10).toString()])),onChange:p=>u(Number(p))}),n.current.hasEdge(t)){const p=n.current.getEdgeAttributes(t),{parallelIndex:m,type:j}=p,S=d.RMP_CLOUD?ye:be,y=i>S&&m<0||j===ne.Simple,x=i>S&&m>=0;g.push({type:"switch",label:s("panel.details.info.parallel"),isDisabled:y,isChecked:m>=0,onChange:f=>r(f,p[p.type].startFrom),oneLine:!0,minW:276}),m>=0&&g.push({type:"input",label:s("panel.details.info.parallelIndex"),variant:"number",isDisabled:x,value:p.parallelIndex.toString(),onChange:f=>l(Number(f)),minW:276})}}else o.size>1&&g.push({type:"input",label:s("panel.details.info.type"),value:s("panel.details.multipleSelection.title"),minW:276});return e.jsxs(z,{p:1,children:[e.jsx(W,{as:"h5",size:"sm",children:s("panel.details.info.title")}),e.jsx(U,{fields:g,minW:130}),o.size===1&&t.startsWith("stn")&&n.current.hasNode(t)&&n.current.getNodeAttribute(t,"type")in H&&e.jsx(Oe,{}),o.size===1&&t.startsWith("line")&&n.current.hasEdge(t)&&n.current.getEdgeAttribute(t,"type")in I&&n.current.getEdgeAttribute(t,"style")in O&&e.jsx(ke,{}),o.size>1&&e.jsx(Re,{})]})}function ze(){const{t:s}=R(),a=P(),{selected:h}=A(y=>y.runtime),[d]=h,o=c.useRef(window.graph),[i,t]=c.useState("undefined"),[n,u]=c.useState("undefined"),[r,l]=c.useState("undefined"),[g,p]=c.useState("undefined");c.useEffect(()=>{var y,x,f,C;if(d!=null&&d.startsWith("line")){const[N,T]=o.current.extremities(d);if(t(N),u(T),N.startsWith("stn")){const k=o.current.getNodeAttribute(N,"type");l((x=(y=o.current.getNodeAttribute(N,k))==null?void 0:y.names.at(0))!=null?x:"undefined")}if(T.startsWith("stn")){const k=o.current.getNodeAttribute(T,"type");p((C=(f=o.current.getNodeAttribute(T,k))==null?void 0:f.names.at(0))!=null?C:"undefined")}}},[h]);const m=q(()=>{a(F()),a(J(i))}),j=q(()=>{a(F()),a(J(n))}),S=[{type:"custom",label:s("panel.details.lineExtremities.source"),component:e.jsx(v,{ml:"auto",size:"sm",variant:"link",onClick:m,children:i}),oneLine:!0,minW:"full"},{type:"input",label:s("panel.details.lineExtremities.sourceName"),value:r,minW:"full"},{type:"custom",label:s("panel.details.lineExtremities.target"),component:e.jsx(v,{ml:"auto",size:"sm",variant:"link",onClick:j,children:n}),oneLine:!0,minW:"full"},{type:"input",label:s("panel.details.lineExtremities.targetName"),value:g,minW:"full"}];return e.jsxs(z,{p:1,children:[e.jsx(W,{as:"h5",size:"sm",children:s("panel.details.lineExtremities.title")}),e.jsx(U,{fields:S,minW:130})]})}function Ie(){const{t:s}=R(),a=P(),h=c.useCallback(()=>{a(L()),a(E()),a(w(t.current.export()))},[a,L,E,w]),{selected:d,refresh:{nodes:o}}=A(l=>l.runtime),[i]=d,t=c.useRef(window.graph),[n,u]=c.useState({x:0,y:0});c.useEffect(()=>{if(i!=null&&i.startsWith("stn")||i!=null&&i.startsWith("misc_node_")){const l=t.current.getNodeAttribute(i,"x"),g=t.current.getNodeAttribute(i,"y");u({x:l,y:g})}},[o,d]);const r=[{type:"input",label:s("panel.details.nodePosition.pos.x"),value:n.x.toString(),validator:l=>!Number.isNaN(l),onChange:l=>{t.current.mergeNodeAttributes(i,{x:Number(l)}),h()}},{type:"input",label:s("panel.details.nodePosition.pos.y"),value:n.y.toString(),validator:l=>!Number.isNaN(l),onChange:l=>{t.current.mergeNodeAttributes(i,{y:Number(l)}),h()}}];return e.jsxs(z,{p:1,children:[e.jsx(W,{as:"h5",size:"sm",children:s("panel.details.nodePosition.title")}),e.jsx(U,{fields:r,minW:130})]})}const Q={...H,...Pe},Me=()=>{var u;const s=P(),{selected:a}=A(r=>r.runtime),{t:h}=R(),[d]=a,o=window.graph.getNodeAttribute(d,"type"),i=o in Q&&Q[o].attrsComponent,t=(u=window.graph.getNodeAttribute(d,o))!=null?u:{},n=(r,l)=>{const g=window.graph.getNodeAttribute(r,"type");window.graph.mergeNodeAttributes(r,{[g]:l}),s(L()),s(w(window.graph.export()))};return i?e.jsx(i,{id:d,attrs:t,handleAttrsUpdate:n}):e.jsx(D,{fontSize:"xs",m:"var(--chakra-space-1)",children:h("panel.details.unknown.error",{category:h("panel.details.unknown.node")})})},De=()=>{var y,x;const s=P(),{preference:{autoParallel:a}}=A(f=>f.app),{selected:h}=A(f=>f.runtime),{t:d}=R(),[o]=h,{type:i,style:t,parallelIndex:n,reconcileId:u}=window.graph.getEdgeAttributes(o),r=(y=window.graph.getEdgeAttribute(o,i))!=null?y:{},l=i in I&&I[i].attrsComponent,g=(x=window.graph.getEdgeAttribute(o,t))!=null?x:{},p=t in O&&O[t].attrsComponent,m=(f,C)=>{let N=-1;if(a){const[T,k]=window.graph.extremities(f);N=se(window.graph,i,T,k,C)}window.graph.setEdgeAttribute(f,"parallelIndex",N)},j=(f,C)=>{window.graph.mergeEdgeAttributes(f,{[i]:C}),s(E()),s(w(window.graph.export()))},S=(f,C)=>{window.graph.mergeEdgeAttributes(f,{[t]:C}),s(E()),s(w(window.graph.export()))};return e.jsxs(e.Fragment,{children:[l?e.jsx(l,{id:o,attrs:r,recalculateParallelIndex:m,handleAttrsUpdate:j,parallelIndex:n}):e.jsx(D,{fontSize:"xs",m:"var(--chakra-space-1)",children:d("panel.details.unknown.error",{category:d("panel.details.unknown.linePath")})}),p?e.jsx(p,{id:o,attrs:g,handleAttrsUpdate:S,reconcileId:u}):e.jsx(D,{fontSize:"xs",m:"var(--chakra-space-1)",children:d("panel.details.unknown.error",{category:d("panel.details.unknown.lineStyle")})})]})},Je=()=>{const{t:s}=R(),a=P(),h=c.useRef(window.graph);c.useCallback(()=>{a(L()),a(E()),a(w(h.current.export()))},[a,L,E,w]);const{activeSubscriptions:d}=A(l=>l.account),{selected:o,mode:i,active:t,count:{masters:n}}=A(l=>l.runtime),[u]=o;!d.RMP_CLOUD&&n+1>Se;const r=()=>a(F());return e.jsxs(je,{isOpen:o.size>0&&!i.startsWith("line")&&!t,width:300,header:"Dummy header",alwaysOverlay:!0,children:[e.jsx(we,{onClose:r,children:s("panel.details.header")}),e.jsxs(Ae,{children:[e.jsx(We,{}),o.size===1&&h.current.hasNode(u)&&e.jsx(Ie,{}),o.size===1&&h.current.hasEdge(u)&&e.jsx(ze,{}),o.size===1&&e.jsxs(z,{p:1,children:[e.jsx(W,{as:"h5",size:"sm",children:s("panel.details.specificAttrsTitle")}),window.graph.hasNode(u)&&e.jsx(Me,{}),window.graph.hasEdge(u)&&e.jsx(De,{})]})]})]})};export{Je as default};
