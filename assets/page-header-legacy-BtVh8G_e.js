System.register(["./chakra-legacy-DU5vZKuW.js","./index-legacy-Cs4gHlmc.js","./react-legacy-Dg_9iw_u.js","./master-manager-legacy-DXyvp0Y3.js"],function(e,t){"use strict";var s,n,r,i,o,l,a,c,d,h,u,p,g,x,m,j,f,b,w,y,C,S,v,_,k,O,z,E,A,M,N,R,T,L,P,I,B,W,D,$,G,F,H,U,V,Y,J,K,Z,q,X,Q,ee,te,se,ne,re,ie,oe,le,ae,ce,de,he,ue,pe,ge,xe,me,je,fe,be,we,ye,Ce,Se,ve,_e,ke,Oe,ze,Ee,Ae,Me,Ne,Re,Te,Le,Pe,Ie,Be,We,De,$e,Ge,Fe,He,Ue,Ve,Ye,Je,Ke,Ze,qe,Xe,Qe,et,tt,st,nt,rt,it,ot,lt,at,ct,dt,ht,ut,pt,gt,xt,mt,jt,ft,bt,wt,yt,Ct,St,vt,_t,kt,Ot,zt,Et,At,Mt,Nt,Rt,Tt,Lt,Pt,It,Bt,Wt,Dt,$t,Gt,Ft,Ht,Ut,Vt,Yt,Jt,Kt,Zt,qt,Xt,Qt;return{setters:[e=>{s=e.j,n=e.af,r=e.M,i=e.ag,o=e.G,l=e.H,a=e.J,c=e.h,d=e.ah,h=e.K,u=e.B,p=e.ai,g=e.aj,x=e.T,m=e.ak,j=e.b,f=e.q,b=e.N,w=e.L,y=e.al,C=e.am,S=e.an,v=e.Q,_=e.ao,k=e.O,O=e.ap,z=e.aq,E=e.a1,A=e.ar,M=e.as,N=e.v,R=e.at,T=e.R,L=e.U,P=e.V,I=e.X,B=e.au,W=e.A,D=e.E,$=e.n,G=e.a7,F=e.e,H=e.t,U=e.m,V=e.z,Y=e.av,J=e.aw,K=e.ax,Z=e.ay,q=e.az,X=e.aA,Q=e.aB,ee=e.a6,te=e.a0,se=e.aC,ne=e.aD,re=e.aE,ie=e.aF,oe=e.aG,le=e.aH,ae=e.aI,ce=e.aJ},e=>{de=e.u,he=e.r,ue=e.C,pe=e.M,ge=e.d,xe=e.n,me=e.S,je=e.R,fe=e.a,be=e.b,we=e.c,ye=e.e,Ce=e.f,Se=e.g,ve=e.h,_e=e.i,ke=e.j,Oe=e.k,ze=e.E,Ee=e.s,Ae=e.l,Me=e.m,Ne=e.L,Re=e.o,Te=e.p,Le=e.q,Pe=e.t,Ie=e.v,Be=e.w,We=e.x,De=e.y,$e=e.z,Ge=e.A,Fe=e.B,He=e.D,Ue=e.F,Ve=e.G,Ye=e.H,Je=e.I,Ke=e.J,Ze=e.K,qe=e.N,Xe=e.O,Qe=e.P,et=e.Q,tt=e.T,st=e.U,nt=e.V,rt=e.W,it=e.X,ot=e.Y,lt=e.Z,at=e._,ct=e.$,dt=e.a0,ht=e.a1,ut=e.a2,pt=e.a3,gt=e.a4,xt=e.a5,mt=e.a6,jt=e.a7,ft=e.a8,bt=e.a9,wt=e.aa,yt=e.ab,Ct=e.ac,St=e.ad,vt=e.ae,_t=e.af,kt=e.ag,Ot=e.ah,zt=e.ai,Et=e.aj,At=e.ak,Mt=e.al,Nt=e.am,Rt=e.an,Tt=e.ao,Lt=e.ap,Pt=e.aq,It=e.ar,Bt=e.as,Wt=e.at,Dt=e.au,$t=e.av,Gt=e.aw,Ft=e.ax},e=>{Ht=e.u,Ut=e.d,Vt=e.T,Yt=e.a},e=>{Jt=e.d,Kt=e.m,Zt=e.a,qt=e.s,Xt=e.f,Qt=e.M}],execute:function(){e("default",function(){return s.jsxs(s.Fragment,{children:[s.jsx(vn,{}),s.jsx(_n,{})]})});var t=function(e){return de(he.ready(),e)};const es=e=>{const{isOpen:t,onClose:f}=e,{t:b}=Ht(),w=he.getAppVersion();return s.jsxs(n,{isOpen:t,onClose:f,size:"xl",scrollBehavior:"inside",children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:b("header.about.title")}),s.jsx(l,{}),s.jsxs(a,{paddingBottom:10,children:[s.jsxs(c,{direction:"row",children:[s.jsx(d,{boxSize:"128px",src:"/rmp//logo192.png"}),s.jsxs(c,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[s.jsx(h,{fontSize:"xl",as:"b",children:b("header.about.rmp")}),s.jsx(h,{children:w}),s.jsx(h,{}),s.jsx(h,{fontSize:"sm",children:b("header.about.railmapgen")})]})]}),s.jsx(u,{margin:5,children:s.jsx(h,{fontSize:"xl",children:b("header.about.desc")})}),s.jsx(p,{as:"h5",size:"sm",mt:3,mb:2,children:b("header.about.contributors")}),s.jsx(p,{as:"h6",size:"xs",my:2,children:b("header.about.coreContributors")}),s.jsxs(g,{children:[s.jsxs(x,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[s.jsx(m,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),s.jsxs(j,{display:"block",width:"100%",children:[s.jsx(h,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),s.jsx(h,{fontSize:"sm",children:b("header.about.content1")}),s.jsx(h,{fontSize:"sm",align:"right",mb:1,children:b("header.about.content2")})]})]}),s.jsxs(x,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/langonginc","_blank"),cursor:"pointer",children:[s.jsx(m,{src:"https://github.com/langonginc.png",size:"lg",my:2,ml:-1,mr:2}),s.jsxs(j,{display:"block",width:"100%",children:[s.jsx(h,{fontSize:"lg",fontWeight:"bold",mb:1,children:"langonginc"}),s.jsx(h,{fontSize:"sm",children:b("header.about.langonginc")}),s.jsx(h,{fontSize:"sm",align:"right",mb:1,children:"--Avicii"})]})]})]}),s.jsx(p,{as:"h6",size:"xs",my:2,children:b("header.about.styleContributors")}),s.jsxs(g,{children:[s.jsxs(x,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/203IhzElttil","_blank"),cursor:"pointer",children:[s.jsx(m,{src:"https://github.com/203IhzElttil.png",size:"lg",my:2,ml:-1,mr:2}),s.jsxs(j,{display:"block",width:"100%",children:[s.jsx(h,{fontSize:"lg",fontWeight:"bold",mb:1,children:"203IhzElttil"}),s.jsx(h,{fontSize:"sm",mb:1,children:b("header.about.203IhzElttil")})]})]}),s.jsxs(x,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Swiftiecott","_blank"),cursor:"pointer",children:[s.jsx(m,{src:"https://github.com/Swiftiecott.png",size:"lg",my:2,ml:-1,mr:2}),s.jsxs(j,{display:"block",width:"100%",children:[s.jsx(h,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Swiftiecott"}),s.jsx(h,{fontSize:"sm",mb:1,children:b("header.about.Swiftiecott")})]})]}),s.jsxs(x,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Minwtraft","_blank"),cursor:"pointer",children:[s.jsx(m,{src:"https://github.com/Minwtraft.png",size:"lg",my:2,ml:-1,mr:2}),s.jsxs(j,{display:"block",width:"100%",children:[s.jsx(h,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Minwtraft"}),s.jsx(h,{fontSize:"sm",mb:1,children:b("header.about.Minwtraft")})]})]})]}),s.jsx(p,{as:"h5",size:"sm",mt:3,mb:2,children:b("header.about.contactUs")}),s.jsxs(g,{children:[s.jsxs(x,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rmp/issues","_blank"),cursor:"pointer",children:[s.jsx(m,{src:"images/github-mark.svg",size:"lg",my:2,ml:-1,mr:2}),s.jsxs(j,{display:"block",width:"100%",children:[s.jsx(h,{fontSize:"lg",fontWeight:"bold",mb:1,children:b("header.about.github")}),s.jsx(h,{fontSize:"sm",children:b("header.about.githubContent")})]})]}),s.jsxs(x,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[s.jsx(m,{src:"images/slack-mark.svg",size:"lg",my:2,ml:-1,mr:2}),s.jsxs(j,{display:"block",width:"100%",children:[s.jsx(h,{fontSize:"lg",fontWeight:"bold",mb:1,children:b("header.about.slack")}),s.jsx(h,{fontSize:"sm",children:b("header.about.slackContent")}),s.jsx(h,{fontSize:"sm",as:"i",children:"#rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),s.jsx(p,{as:"h5",size:"sm",mt:3,mb:2,children:b("header.donation.title")}),s.jsxs(g,{children:[s.jsxs(x,{size:"lg",w:"85%",onClick:()=>window.open("https://afdian.com/a/rail-map-toolkit","_blank"),cursor:"pointer",children:[s.jsx(m,{src:"images/afdian.png",size:"lg",my:2,ml:-1,mr:2}),s.jsxs(j,{display:"block",width:"100%",pb:1,children:[s.jsx(h,{fontSize:"lg",fontWeight:"bold",mb:1,children:b("header.donation.afdian")}),s.jsx(h,{fontSize:"sm",children:b("header.donation.viaCNY")})]})]}),s.jsxs(x,{size:"lg",w:"85%",onClick:()=>window.open("https://opencollective.com/rail-map-toolkit","_blank"),cursor:"pointer",children:[s.jsx(m,{src:"images/opencollective-icon.webp",size:"lg",my:2,ml:-1,mr:2}),s.jsxs(j,{display:"block",width:"100%",pb:1,children:[s.jsx(h,{fontSize:"lg",fontWeight:"bold",mb:1,children:b("header.donation.openCollective")}),s.jsx(h,{fontSize:"sm",children:b("header.donation.viaUSD")})]})]})]})]})]})]})};
/*!
             * canvas-size
             * v2.0.0
             * https://github.com/jhildenbiddle/canvas-size
             * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
             * MIT license
             */function ts(e){const t=e.sizes.shift(),s=Math.max(Math.ceil(t[0]),1),n=Math.max(Math.ceil(t[1]),1),r=[s-1,n-1,1,1],i=performance.now(),o="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;let l,a;o?(l=new OffscreenCanvas(1,1),a=new OffscreenCanvas(s,n)):(l=document.createElement("canvas"),l.width=1,l.height=1,a=document.createElement("canvas"),a.width=s,a.height=n);const c=l.getContext("2d"),d=a.getContext("2d");d&&(d.fillRect.apply(d,r),c.drawImage(a,s-1,n-1,1,1,0,0,1,1));const h=c&&0!==c.getImageData(0,0,1,1).data[3],u=parseInt(performance.now()-i);return[l,a].forEach(e=>{e.height=0,e.width=0}),o?(postMessage({width:s,height:n,testTime:u,isTestPass:h}),!h&&e.sizes.length&&setTimeout(()=>{ts(e)},0)):h?e.onSuccess({width:s,height:n,testTime:u}):(e.onError({width:s,height:n,testTime:u}),e.sizes.length&&setTimeout(()=>{ts(e)},0)),h}const ss={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},ns={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},rs={};function is(e){const t=e.width===e.height,s=1===e.height,n=1===e.width,r=[];if(e.width&&e.height){const i=e.min||ns.min,o=e.step||ns.step;let l=Math.max(e.width,e.height);for(;l>=i;){const e=t||s?l:1,i=t||n?l:1;r.push([e,i]),l-=o}}else e.sizes.forEach(e=>{const i=t||s?e:1,o=t||n?e:1;r.push([i,o])});return r}function os(e){const t="undefined"!=typeof window,s=t&&"Promise"in window,n=t&&"HTMLCanvasElement"in window,r=t&&"OffscreenCanvas"in window,i=URL.createObjectURL(new Blob([])).slice(-36),o=performance.now(),{onError:l,onSuccess:a,...c}=e,d=()=>parseInt(performance.now()-o);let h=null;if(!n)return!1;if(e.useWorker&&r){const e=`\n            var canvasTest = ${ts.toString()};\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        `,t=new Blob([e],{type:"application/javascript"}),s=URL.createObjectURL(t);h=new Worker(s),URL.revokeObjectURL(s),h.onmessage=function(e){const{width:t,height:s,testTime:n,isTestPass:r}=e.data,o={width:t,height:s,testTime:n,totalTime:d()};r?(rs[i].onSuccess(o),delete rs[i]):rs[i].onError(o)}}return s?new Promise(t=>{const s={...e,onError(s){let{width:n,height:r,testTime:i}=s;const o={width:n,height:r,testTime:i,totalTime:d()};let a;if(0===e.sizes.length)a=!0;else{const[[t,s]]=e.sizes.slice(-1);a=n===t&&r===s}l(o),a&&t({...o,success:!1})},onSuccess(e){let{width:s,height:n,testTime:r}=e;const i={width:s,height:n,testTime:r,totalTime:d()};a(i),t({...i,success:!0})}};if(h){const{onError:e,onSuccess:t}=s;rs[i]={onError:e,onSuccess:t},h.postMessage(c)}else ts(s)}):h?(rs[i]={onError:l,onSuccess:a},void h.postMessage(c)):ts(e)}const ls={maxArea(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=is({width:e.max,height:e.max,min:e.min,step:e.step,sizes:[...ss.area]});return os({...ns,...e,sizes:t})},maxHeight(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=is({width:1,height:e.max,min:e.min,step:e.step,sizes:[...ss.height]});return os({...ns,...e,sizes:t})},maxWidth(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=is({width:e.max,height:1,min:e.min,step:e.step,sizes:[...ss.width]});return os({...ns,...e,sizes:t})},test(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t={...ns,...e};return t.sizes=[...t.sizes],t.width&&t.height&&(t.sizes=[[t.width,t.height]]),os(t)}};var as=(e=>(e.left="l",e.right="r",e))(as||{}),cs=(e=>(e.through="through",e.nonThrough="nonthrough",e))(cs||{}),ds=(e=>(e.local="local",e.express="express",e.direct="direct",e))(ds||{}),hs=(e=>(e.MTR="mtr",e.GZMTR="gzmtr",e.SHMetro="shmetro",e))(hs||{}),us=(e=>(e.sh="sh",e.sh2020="sh2020",e))(us||{});const ps=new Set,gs=new Set,xs=new Set,ms=new Set,js=new Map,fs=new Map,bs=new Set,ws=new Map,ys=new Map;let Cs=[],Ss=0;const vs=new Map,_s=new Map,ks=new Set,Os={localisedName:{en:"LEFT END"},num:"00",services:[ds.local],parents:[],children:["lineend"],transfer:{groups:[{}],tick_direc:as.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},zs={localisedName:{en:"RIGHT END"},num:"00",services:[ds.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:as.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},Es={svgWidth:{destination:1500,runin:1500,railmap:1500,indoor:1500},svg_height:400,style:hs.SHMetro,y_pc:50,padding:10,branchSpacingPct:33,direction:as.right,platform_num:"1",theme:[ue.Shanghai,"sh1","#E3002B",pe.white],line_name:["地鐵線","Metro Line"],current_stn_idx:"jlaMj2",stn_list:{},namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:us.sh,direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:0,bottom_factor:1},coachNum:"1"},As={localisedName:{},num:"",services:[ds.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:as.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},Ms=e=>`${e[0]}/${e[1]}=${e[2]}${e[3]}`,Ns=e=>ge.has(e),Rs=(e,t)=>{const[s,n]=e.extremities(t),r=e.getEdgeAttributes(t),i=r.style;if(s!=n&&Ns(i)){const e=(e=>{if(Ns(e.style))return structuredClone(e[e.style].color)})(r);ms.has(Ms(e))||(xs.add(e),ms.add(Ms(e)),js.set(e,s),fs.set(Ms(e),new Set)),fs.get(Ms(e)).add(s),fs.get(Ms(e)).add(n),ys.has(s)?Cs.push({target:n,next:ys.get(s),color:e}):Cs.push({target:n,next:-1,color:e}),ys.set(s,Ss),Ss++,ys.has(n)?Cs.push({target:s,next:ys.get(n),color:e}):Cs.push({target:s,next:-1,color:e}),ys.set(n,Ss),Ss++}},Ts=(e,t,s)=>{if(fs.get(Ms(s)).has(e)){fs.get(Ms(s)).delete(e);for(let t=ys.get(e);-1!=t;t=Cs[t].next){const n=Cs[t].target,r=Cs[t].color;Ms(r)==Ms(s)&&Ts(n,e,s)}}},Ls=(e,t,s)=>{if(ps.has(e))return;ps.add(e);let n=0;const r=new Set;for(let i=ys.get(e);-1!=i;i=Cs[i].next){const o=Cs[i].target,l=Cs[i].color;Ms(l)==Ms(s)&&(r.has(o)||(r.add(o),n++,o!=t&&Ls(o,e,s)))}vs.set(e,n)},Ps=(e,t)=>{const s=e.stn_list.lineend.parents;s.push(t),e.stn_list.lineend.parents=structuredClone(s).reverse(),e.stn_list.lineend.branch={...e.stn_list.lineend.branch,left:2==e.stn_list.lineend.parents.length?[cs.through,s[1]]:void 0}},Is=(e,t,s)=>{if(ks.has(e))return[];ks.add(e);const n=[];for(let r=ys.get(e);-1!=r;r=Cs[r].next){const i=Cs[r].target,o=Cs[r].color;i!=t&&Ms(o)==Ms(s)&&(i.startsWith("stn")?n.push(i):n.push(...Is(i,e,s)))}return n},Bs=(e,t,s,n,r,i,o)=>{if(ps.has(e)&&(!e.startsWith("misc_node_")&&null==o.stn_list[e]||e.startsWith("misc_node_")&&!gs.has(e)||o.loop))return[];if(ps.has(e)&&null!=o.stn_list[e]&&((e,t)=>{let s=0;for(let n=ys.get(e);-1!=n;n=Cs[n].next){Cs[n].target;const e=Cs[n].color;Ms(e)==Ms(t)&&s++}return s})(e,i)-1>=2){const s=[...o.stn_list[e].parents,t];if(null==o.stn_list[s[1]]){const e=s[0];s[0]=s[1],s[1]=e}o.stn_list[e].parents=structuredClone(s).reverse(),o.stn_list[e].branch={...o.stn_list[e].branch,left:[cs.through,s[1]]};const n=[];for(const i of o.stn_list[e].children)i!=t&&n.push(i);o.stn_list[e].children=structuredClone(n),delete o.stn_list[e].branch?.right;const r=[];for(const t of o.stn_list.lineend.parents)t!=e&&r.push(t);return o.stn_list.lineend.parents=structuredClone(r).reverse(),o.stn_list.lineend.branch={...o.stn_list.lineend.branch,left:2==o.stn_list.lineend.parents.length?[cs.through,r[1]]:void 0},0==n.length&&(o.stn_list[e].children=["lineend"],Ps(o,e)),[e]}ps.add(e);const l=[],a=[],c=[],d=new Set,h=new Set;for(let u=ys.get(e);-1!=u;u=Cs[u].next){const a=Cs[u].target,p=Cs[u].color;if(a!=s){if(Ms(p)==Ms(i)){if(h.has(a))continue;if(h.add(a),e.startsWith("misc_node_")){const s=Bs(a,t,e,n+1,r,i,o);0!=s.length&&l.push(...s)}else{const t=Bs(a,e,e,n+1,r,i,o);0!=t.length&&l.push(...t)}}if(!d.has(Ms(p))&&Ms(p)!=Ms(i)){d.add(Ms(p));const e={theme:p,name:[`ch_${Ms(p)}`,`en_${Ms(p)}`]};c.push(e)}}}if(2==l.length){for(let e=0;e<2;e++)"lineend"==l[e]&&l.splice(e,1);if(o.stn_list[l[1]].parents.length>=2){const e=l[0];l[0]=l[1],l[1]=e}}if(ps.has(e)&&null!=o.stn_list[e]){const s=[];for(const t of o.stn_list.lineend.parents)t!=e&&s.push(t);o.stn_list.lineend.parents=structuredClone(s).reverse(),o.stn_list.lineend.branch={...o.stn_list.lineend.branch,left:2==o.stn_list.lineend.parents.length?[cs.through,s[1]]:void 0},0==l.length&&(ks.clear(),a.push(...Is(e,t,i)))}if(e.startsWith("misc_node_"))return gs.add(e),l;{const s=r.getNodeAttributes(e).type,d=r.getNodeAttributes(e)[s];if(o.stn_list[e]=structuredClone(As),o.stn_list[e].localisedName={zh:d.names[0],en:d.names[1]},o.stn_list[e].num=String(n),r.getNodeAttributes(e).type==me.GzmtrBasic){const t=d;o.stn_list[e].num=t.stationCode,""===t.secondaryNames[0]&&""===t.secondaryNames[1]||(o.stn_list[e].localisedSecondaryName={zh:t.secondaryNames[0],en:t.secondaryNames[1]})}if(r.getNodeAttributes(e).type==me.GzmtrInt){const t=d,s=t.transfer[0];for(const n of s)if(Ms(n)==Ms(i)){o.stn_list[e].num=String(n[5]);break}""===t.secondaryNames[0]&&""===t.secondaryNames[1]||(o.stn_list[e].localisedSecondaryName={zh:t.secondaryNames[0],en:t.secondaryNames[1]})}return 0!=l.length?(o.stn_list[e].children=structuredClone(l).reverse(),2==l.length&&(o.stn_list[e].branch={...o.stn_list[e].branch,right:[cs.through,l[1]]})):(o.stn_list[e].children=["lineend"],Ps(o,e)),a.push(t),o.stn_list[e].parents=structuredClone(a).reverse(),2==a.length&&(o.stn_list[e].branch={...o.stn_list[e].branch,left:[cs.through,a[1]]}),0!=c.length&&(o.stn_list[e].transfer.groups[0].lines=structuredClone(c)),[e]}},Ws=(e,t,s,n)=>{const r=structuredClone(Es);let i;switch("LOOP"==n&&(r.loop=!0),e.getNodeAttributes(s).type){case me.GzmtrBasic:case me.GzmtrInt:i=hs.GZMTR;break;case me.MTR:i=hs.MTR;break;default:i=hs.SHMetro}r.theme=structuredClone(t),r.style=i,r.stn_list.linestart=structuredClone(Os),r.stn_list.lineend=structuredClone(zs),ps.clear(),gs.clear();const o=Bs(s,"linestart","linestart",1,e,t,r);return r.current_stn_idx=o[0],r.stn_list.linestart.children=[o[0]],Object.keys(r.stn_list).length<=3||r.stn_list.lineend.parents.length>=3?void 0:structuredClone(r)},Ds=(e,t,s,n)=>{var r;e.line_name=t,e.line_num=String(s),Jt(`RMG_${r=t,""!=r[0]&&""!=r[1]?r[0]+"_"+r[1]:""!=r[0]?r[0]:""!=r[1]?r[1]:`${(new Date).valueOf()}`}.json`,"application/json",((e,t)=>{let s=e;return t.forEach((e,t)=>{const n=new RegExp(`ch_${t}`,"g"),r=new RegExp(`en_${t}`,"g");s=s.replace(n,e[0]),s=s.replace(r,e[1])}),s})(JSON.stringify(e),n))},$s={LINE:"#33ccff",BRANCH:"#007B61",LOOP:"#ff6666"},Gs=e=>{const{isOpen:t,onClose:c}=e,{t:d}=Ht(),u=Ut.useRef(window.graph),[p,g]=Ut.useState(!1),[x,m]=Ut.useState([[Es,"",""]]),[j,y]=Ut.useState(["","",""]),[C,S]=Ut.useState(new Map),[v,_]=Ut.useState(new Map),[k,O]=Ut.useState([]);Ut.useEffect(()=>{if(t){const e=(e=>{ps.clear(),xs.clear(),ms.clear(),js.clear(),fs.clear(),bs.clear(),ws.clear(),ys.clear(),Cs=[],Ss=0,vs.clear(),_s.clear(),e.filterEdges(e=>e.startsWith("line")).forEach(t=>{Ns(e.getEdgeAttributes(t).style)&&Rs(e,t)});let t=0;e.forEachNode(e=>{_s.set(e,++t)}),_s.set("lineend",++t);const s=[];for(const n of xs){let e=0;for(;0!=fs.get(Ms(n)).size;){let t="line_root";fs.get(Ms(n)).forEach(e=>{"line_root"==t&&(t=e)}),Ts(t,"line_root",n);const s={theme:n,index:++e};bs.add(s),ws.set(s,t)}}for(const n of bs){const{theme:t}=n;ps.clear(),vs.clear(),Ls(ws.get(n),"line_root",t);let r=!0,i="LINE";const o=[];for(const[e,s]of vs)1==s&&o.push(e),3==s&&(i="BRANCH"),s>3&&(r=!1);if(!r)continue;0==o.length&&(i="LOOP",vs.forEach((e,t)=>{o.push(t)}));const l=[];for(const s of o){const n=Ws(e,t,s,i);null!=n&&l.push([n,n.stn_list[n.current_stn_idx].localisedName.zh??"",n.stn_list[n.current_stn_idx].localisedName.en??""])}0!=l.length&&s.push({id:xe(10),theme:t,param:structuredClone(l),type:i})}return s})(u.current),t=new Map;e.forEach(({id:e,theme:s})=>{t.set(Ms(s),e)}),O(e),S(t)}},[t]);const z=(e,t)=>document.getElementById("2RMG_"+t+"_"+e).value.trim();return s.jsxs(n,{isOpen:t,onClose:c,size:"2xl",scrollBehavior:"inside",blockScrollOnMount:!1,children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:s.jsx(h,{as:"b",fontSize:"xl",children:d("header.download.2rmg.title")})}),s.jsx(l,{}),s.jsxs(a,{children:[s.jsx(h,{fontSize:"sm",mt:"3",lineHeight:"100%",children:d("header.download.2rmg.info1")}),s.jsx(h,{fontSize:"sm",mt:"3",lineHeight:"100%",children:d("header.download.2rmg.info2")}),s.jsx("br",{}),0===k.length?s.jsx(h,{fontSize:"md",children:d("header.download.2rmg.noline")}):s.jsx("table",{children:s.jsx("tbody",{children:k.map(({id:e,theme:t,param:n,type:r})=>s.jsxs("tr",{children:[s.jsx("td",{children:s.jsx(je,{name:"other"==t[0]&&"other"==t[1]?t[2]:t[1],bg:t[2],fg:t[3]})}),s.jsx("td",{children:s.jsx(f,{placeholder:d("header.download.2rmg.placeholder.chinese"),id:`2RMG_nameCh_${e}`,size:"sm"})}),s.jsx("td",{children:s.jsx(f,{placeholder:d("header.download.2rmg.placeholder.english"),id:`2RMG_nameEn_${e}`,size:"sm"})}),s.jsx("td",{children:s.jsx(f,{placeholder:d("header.download.2rmg.placeholder.lineCode"),id:`2RMG_lineNum_${e}`,size:"sm"})}),s.jsx("td",{children:s.jsx(je,{name:d(`header.download.2rmg.type.${r.toLowerCase()}`),bg:$s[r],fg:pe.white})}),s.jsx("td",{children:s.jsx(b,{colorScheme:"blue",variant:"ghost",mr:"1",onClick:()=>{const t=z(e,"nameCh"),s=z(e,"nameEn"),r=z(e,"lineNum"),i=new Map;C.forEach((e,t)=>{i.set(t,[z(e,"nameCh"),z(e,"nameEn")])}),m(n),y([t,s,r]),_(i),g(!0)},size:"sm",children:s.jsx(fe,{})})})]},e))})})]}),s.jsx(w,{children:s.jsx(b,{colorScheme:"blue",variant:"outline",mr:"1",onClick:c,children:d("close")})})]}),s.jsx(Fs,{isOpen:p,onClose:()=>g(!1),param:x,nameList:j,interchangeName:v})]})},Fs=e=>{const{isOpen:t,onClose:c,param:d,nameList:u,interchangeName:p}=e,{t:g}=Ht(),[x,m]=Ut.useState("");return Ut.useEffect(()=>{""!=u[0]&&""!=u[1]?m(u[0]+"/"+u[1]):""!=u[0]?m(u[0]):""!=u[1]?m(u[1]):m("")},[...u]),s.jsxs(n,{isOpen:t,onClose:c,size:"md",scrollBehavior:"inside",children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:s.jsxs(h,{as:"b",fontSize:"xl",children:[g("header.download.2rmg.download")," ",x]})}),s.jsx(l,{}),s.jsx(a,{children:s.jsxs(y,{children:[s.jsx(h,{fontSize:"sm",mb:"2",lineHeight:"100%",children:g("header.download.2rmg.downloadInfo")}),d.map(([e,t,n])=>s.jsxs(b,{onClick:()=>{Ds(e,[u[0],u[1]],u[2],p)},overflow:"hidden",size:"md",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:[t.replaceAll("\n","⏎"),"/",n.replaceAll("\n","⏎")]},`${t}${n}`))]})}),s.jsx(w,{children:s.jsx(b,{colorScheme:"blue",variant:"outline",mr:"1",onClick:c,children:g("close")})})]})]})},Hs=e=>{const{isOpen:t,onClose:c}=e,{t:d}=Ht();return s.jsxs(n,{isOpen:t,onClose:c,size:"xl",scrollBehavior:"inside",children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:d("header.download.termsAndConditions")}),s.jsx(l,{}),s.jsx(a,{children:s.jsxs(C,{children:[s.jsxs(S,{children:["The layout of the elements on the signage or rail map, is designed by"," ",s.jsxs(v,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",s.jsx(_,{as:be})]}),", ",s.jsxs(v,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",s.jsx(_,{as:be})]})," or ",s.jsxs(v,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",s.jsx(_,{as:be})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",s.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",s.jsxs(v,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",s.jsx(_,{as:be})]}),"，",s.jsxs(v,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",s.jsx(_,{as:be})]}),"或",s.jsxs(v,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",s.jsx(_,{as:be})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),s.jsxs(S,{children:["The elements including shapes and lines on the image are drawn by"," ",s.jsxs(v,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",s.jsx(_,{as:be})]})," and ",s.jsxs(v,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",s.jsx(_,{as:be})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",s.jsx("br",{}),"图像的元素，包括图形及线条，均由",s.jsxs(v,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",s.jsx(_,{as:be})]}),"及",s.jsxs(v,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",s.jsx(_,{as:be})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),s.jsxs(S,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",s.jsxs(v,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",s.jsx(_,{as:be})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",s.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",s.jsxs(v,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",s.jsx(_,{as:be})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),s.jsxs(S,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",s.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),s.jsxs(S,{children:["All flag emojis shown on Windows platforms are designed by"," ",s.jsxs(v,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",s.jsx(_,{as:be})]})," ","– the open-source emoji and icon project. License:",s.jsxs(v,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",s.jsx(_,{as:be})]}),s.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",s.jsxs(v,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",s.jsx(_,{as:be})]}),"所设计。许可证：",s.jsxs(v,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",s.jsx(_,{as:be})]})]}),s.jsxs(S,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",s.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})},Us=()=>{const e=new Date,t=`${e.getFullYear()}${String(e.getMonth()+1).padStart(2,"0")}01`,s=`${String(e.getFullYear()).slice(-2)}.${e.getMonth()+1}.1`,n=navigator.platform;return`https://ghfast.top/https://github.com/railmapgen/railmapgen.github.io/releases/download/tauri-${t}/Rail.Map.Toolkit_${s}_${n.includes("Linux")?"amd64.AppImage":n.includes("Mac")?"aarch64.dmg":"x64-setup.exe"}`};function Vs(){const e=k("white","var(--chakra-colors-gray-800)"),t=we(),{activeSubscriptions:{RMP_EXPORT:c}}=ye(e=>e.account),{telemetry:{project:d}}=ye(e=>e.app),{languages:p}=ye(e=>e.fonts),g=ye(e=>e.param),x=he.isAllowAnalytics(),{t:m}=Ht(),j=Ut.useRef(window.graph),[f,y]=Ut.useState("png"),C={png:m("header.download.png"),svg:m("header.download.svg")},[S,W]=Ut.useState(2),[D,$]=Ut.useState({width:1,height:1,benchmark:.001}),[G,F]=Ut.useState(200),H=[25,50,100,150,200,250,300,400,500,750,1e3,1500,2e3],U=Object.fromEntries(H.map(e=>[e,`${e}%`])),[V,Y]=Ut.useState([]),[J,K]=Ut.useState(!1),Z=[{type:"select",label:m("header.download.format"),value:f,options:C,onChange:e=>y("png"===e?"png":"svg")}],q=[{type:"select",label:m("header.download.svgVersion"),value:S,options:{1.1:m("header.download.svg1.1"),2:m("header.download.svg2")},onChange:e=>{W(e),1.1===e&&re(!0)}}],X=[{type:"select",label:m("header.download.scale"),value:G,options:U,onChange:e=>F(e)},{type:"switch",label:m("header.download.transparent"),isChecked:J,onChange:K}],[Q,ee]=Ut.useState(!1),[te,se]=Ut.useState(!1),[ne,re]=Ut.useState(!1),[ie,oe]=Ut.useState(!1),[le,ae]=Ut.useState(!1),[ce,de]=Ut.useState(!1),[ue,pe]=Ut.useState(!1);return Ut.useEffect(()=>{(async()=>{const e=await ls.maxArea({usePromise:!0,useWorker:!0});$(e)})()},[]),Ut.useEffect(()=>{if(Q){const{xMin:e,yMin:t,xMax:s,yMax:n}=Ce(j.current),[r,i]=[s-e,n-t],o=H.filter(e=>r*e/100>D.width&&i*e/100>D.height);Y(o)}},[Q]),s.jsxs(O,{id:"download",children:[s.jsx(z,{as:E,size:"sm",variant:"ghost",icon:s.jsx(fe,{})}),s.jsxs(A,{children:[s.jsx(M,{icon:s.jsx(Se,{}),onClick:()=>{x&&he.event(ze.DOWNLOAD_PARAM,d?{"#nodes":j.current.order,"#edges":j.current.size}:{}),Jt(`RMP_${(new Date).valueOf()}.json`,"application/json",Ee(g))},children:m("header.download.config")}),s.jsxs(M,{icon:s.jsx(ve,{}),onClick:()=>pe(!0),children:[m("header.download.2rmg.title"),s.jsx(N,{ml:"1",colorScheme:"green",children:"New"})]}),s.jsx(M,{icon:s.jsx(_e,{}),onClick:()=>ee(!0),children:m("header.download.image")})]}),s.jsxs(n,{size:"xl",isOpen:Q,onClose:()=>ee(!1),children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:m("header.download.image")}),s.jsx(l,{}),s.jsxs(a,{children:[s.jsx(Oe,{fields:Z}),"svg"===f&&s.jsx(Oe,{fields:q}),"png"===f&&s.jsx(Oe,{fields:X}),s.jsx("br",{}),s.jsx(R,{isChecked:ne,isDisabled:"svg"===f&&1.1===S,onChange:e=>re(e.target.checked),children:s.jsx(h,{children:m("header.download.isSystemFontsOnly")})}),s.jsx(R,{id:"share_info",isChecked:ie,onChange:e=>oe(e.target.checked),children:s.jsxs(h,{children:[m("header.download.shareInfo1"),s.jsxs(v,{color:"teal.500",onClick:()=>window.open("https://railmapgen.github.io/rmp","_blank"),children:[m("header.about.rmp")," ",s.jsx(_,{as:be})]}),m("header.download.shareInfo2")]})}),s.jsx(R,{id:"agree_terms",isChecked:le,onChange:e=>ae(e.target.checked),children:s.jsxs(h,{children:[m("header.download.termsAndConditionsInfo"),s.jsxs(v,{color:"teal.500",onClick:()=>se(!0),children:[m("header.download.termsAndConditions")," ",s.jsx(_,{as:be})]}),m("header.download.period")]})}),"png"===f&&V.includes(G)&&!ke&&s.jsxs(T,{status:"error",mt:"4",children:[s.jsx(L,{}),s.jsxs(u,{children:[s.jsx(P,{children:m("header.download.disabledScaleOptions")}),s.jsx(I,{children:s.jsx(Vt,{i18nKey:"header.download.disabledScaleOptionsSolution",components:{link1:s.jsx(v,{color:"teal.500",textDecoration:"underline",cursor:"pointer",href:"https://afdian.com/item/9c8b220c614311efab2d52540025c377",target:"_blank"}),link2:s.jsx(v,{color:"teal.500",textDecoration:"underline",cursor:"pointer",href:Us()})}})})]})]}),"png"===f&&V.includes(G)&&ke&&!c&&s.jsxs(T,{status:"error",mt:"4",children:[s.jsx(L,{}),s.jsxs(u,{children:[s.jsx(P,{children:m("header.download.disabledScaleOptions")}),s.jsx(I,{children:m("header.settings.pro")})]})]})]}),s.jsx(w,{children:s.jsx(B,{children:s.jsx(b,{id:"download_button",colorScheme:"teal",variant:"outline",size:"sm",isDisabled:!le||"png"===f&&V.includes(G)&&!ke||"png"===f&&V.includes(G)&&ke&&!c,isLoading:ce,onClick:async()=>{de(!0),x&&he.event(ze.DOWNLOAD_IMAGES,d?{numberOfNodes:j.current.order,numberOfEdges:j.current.size}:{});const{elem:s,width:n,height:r}=await Kt(j.current,ie,ne,p,S),i=s.outerHTML.replace(/&nbsp;/g," ");if("svg"===f)return Jt(`RMP_${(new Date).valueOf()}.svg`,"image/svg+xml",i),void de(!1);if(ke)return void window.parent.__TAURI__.core.invoke("render_image",{svgString:i,scale:G,isTransparent:J,isSystemFontsOnly:ne}).then(()=>de(!1));document.body.appendChild(s);const o="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(i)));document.body.removeChild(s),s.remove();const l=document.createElement("canvas"),[a,c]=[n*G/100,r*G/100];l.width=a,l.height=c;const h=l.getContext("2d");J||(h.fillStyle=e,h.fillRect(0,0,a,c));const u=new Image;u.onload=()=>{setTimeout(()=>{h.drawImage(u,0,0,a,c),l.toBlob(e=>{de(!1),e?Zt(`RMP_${(new Date).valueOf()}.png`,e):t(Ae({status:"error",message:m("header.download.imageTooBig")}))},"image/png")},Me()?2e3:0)},u.src=o},children:m("header.download.confirm")})})}),s.jsx(Hs,{isOpen:te,onClose:()=>se(!1)})]})]}),s.jsx(Gs,{isOpen:ue,onClose:()=>pe(!1)})]})}function Ys(e){const{isOpen:t,onClose:n,onConfirm:i}=e,{t:l}=Ht(),c=Ut.useRef(null);return s.jsx(W,{isOpen:t,leastDestructiveRef:c,onClose:n,children:s.jsx(r,{children:s.jsxs(D,{children:[s.jsx(o,{fontSize:"lg",fontWeight:"bold",children:l("header.open.confirmOverwrite.title")}),s.jsx(a,{children:l("header.open.confirmOverwrite.body")}),s.jsxs(w,{children:[s.jsx(b,{ref:c,onClick:n,children:l("cancel")}),s.jsx(b,{id:"confirm_overwrite",colorScheme:"red",onClick:i,ml:3,children:l("header.open.confirmOverwrite.overwrite")})]})]})})})}const Js=(e,{info_panel_type:t,line_num:s,stn_list:n,style:r,theme:i},o,l,a)=>{const c=Object.fromEntries(Object.keys(n).filter(e=>!["linestart","lineend"].includes(e)).map(e=>[e,`stn_${xe(10)}`]));Object.entries(n).filter(([e,t])=>!["linestart","lineend"].includes(e)).forEach(([t,s])=>{const n=e.filterNodes((e,t)=>Object.values(me).includes(t.type)&&t[t.type].names[0]===s.localisedName.zh);0!==n.length&&(c[t]=n[0])});const d=[["linestart",-1,0]],h={};for(;d.length;){const[e,t,s]=d.shift();n[e].children.filter(e=>"lineend"!=e).forEach((e,n)=>{const r=Math.max(n,s+n);h[e]={x:150*t,y:75*r},d.push([e,t+1,r])})}Object.entries(n).filter(([e,t])=>!["linestart","lineend"].includes(e)).filter(([t,s])=>0===e.filterNodes((e,t)=>Object.values(me).includes(t.type)&&t[t.type].names[0]===s.localisedName.zh).length).map(([e,n])=>{let a=me.ShmetroBasic;const d=n.transfer.groups,u=d.map(e=>e.lines??[]).flat();r===hs.SHMetro?a=u.length>0?me.ShmetroInt:t===us.sh2020?me.ShmetroBasic2020:me.ShmetroBasic:r===hs.GZMTR?a=u.length>0?me.GzmtrInt:me.GzmtrBasic:r===hs.MTR&&(a=me.MTR);const p={...structuredClone(qt[a].defaultAttrs),names:[n.localisedName.zh??"",n.localisedName.en??""]};return a===me.ShmetroBasic2020?p.color=i:a===me.GzmtrBasic?(p.color=i,p.lineCode=s,p.stationCode=n.num):a===me.GzmtrInt?p.transfer=d.map((e,t)=>{const r=e.lines?.map(e=>[...e.theme??i,"1","01"])??[];return 0===t?[[...i,s,n.num],...r]:r}):a===me.MTR&&(d[0].lines?.length?p.transfer=[[[...i,"",""],...d[0].lines.map(e=>[...e.theme??i,"",""])]]:p.transfer=[[]]),{node:c[e],attr:{visible:!0,zIndex:0,x:o+h[e].x,y:l+h[e].y,type:a,[a]:p}}}).forEach(({node:t,attr:s})=>e.addNode(t,s)),Object.entries(n).filter(([e,t])=>!["linestart","lineend"].includes(e)).forEach(([t,s])=>{s.children.filter(e=>!["linestart","lineend"].includes(e)).forEach(s=>{const n=Ne.Diagonal,[r,o]=[c[t],c[s]],l=a?Re(e,n,r,o,"from"):-1;e.addDirectedEdgeWithKey(`line_${xe(10)}`,r,o,{visible:!0,zIndex:0,type:n,[Ne.Diagonal]:structuredClone(Le[Ne.Diagonal].defaultAttrs),style:Te.SingleColor,[Te.SingleColor]:{color:i},reconcileId:"",parallelIndex:l})})})},Ks="rmg-bridge--",Zs={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function qs(e){const{isOpen:t,onClose:n}=e,{t:r}=Ht(),{preference:{autoParallel:i}}=ye(e=>e.app),{svgViewBoxZoom:o,svgViewBoxMin:l}=ye(e=>e.param),a=we(),c=he.isAllowAnalytics(),d=Pe(),{height:h,width:u}=Ie(d),p=Yt.useRef(window.graph),[g]=Yt.useState(crypto.randomUUID()),x="/rmg/#/import?"+new URLSearchParams({parentComponent:he.getAppName(),parentId:g}),m=Yt.useCallback(()=>{a(Be()),a(We()),a(De(p.current.export()))},[a,Be,We,De,p]);return Yt.useEffect(()=>{const e=new BroadcastChannel(Ks+g);return e.onmessage=e=>{const{event:t,data:s}=e.data;console.log("[rmp] Received event from RMG app clip:",t),"CLOSE"===t?n():"IMPORT"===t&&(e=>{try{c&&he.event(ze.IMPORT_RMG_PARAM,{});const t=l.x+u*o/100/3,s=l.y+h*o/100/3;Js(p.current,e,t,s,i),m()}catch(t){a(Ae({status:"error",message:r("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",t)}finally{n()}})(s)},()=>e.close()},[l.x,l.y,o,h,u,i]),s.jsx($e,{isOpen:t,onClose:n,sx:Zs,children:s.jsx("iframe",{src:x,loading:"lazy"})})}const Xs="OPEN_TEMPLATE",Qs=new BroadcastChannel("RMP_GALLERY_CHANNEL"),en={h:"80%",w:"80%","& iframe":{h:"100%",w:"100%"},"& div":{h:"100%",w:"100%"}};function tn(e){const{isOpen:t,onClose:n}=e,{t:r}=Ht(),i=we(),{isOpen:o,onOpen:l,onClose:a}=$(),[c,d]=Ut.useState(null),{telemetry:{project:h}}=ye(e=>e.app),u=he.isAllowAnalytics(),p=Ut.useRef(window.graph),g=Ut.useCallback(()=>{i(Be()),i(We()),i(De(p.current.export()))},[i,Be,We,De,p]),x=async(e,t)=>{const s=t?`https://${t}`:"",n=await((await Promise.allSettled([fetch(`${s}/rmp-gallery/resources/real_world/${e}.json`),fetch(`${s}/rmp-gallery/resources/fantasy/${e}.json`)])).filter(e=>"fulfilled"===e.status).find(e=>200===e.value.status)?.value.json());if(n){if(d(n),l(),u){const s={id:e};h&&t&&(s.host=t),he.event(ze.IMPORT_WORK_FROM_GALLERY,s)}he.sendNotification({title:r("header.open.importOK",{id:e}),message:r("header.open.importOKContent"),type:"success",duration:9e3})}else he.sendNotification({title:r("header.open.importFail",{id:e}),message:r("header.open.importFailContent"),type:"error",duration:9e3})};return Ut.useEffect(()=>{const e=new URL(window.location.href).searchParams;if(e.size>0){const t=e.keys().next().value,s=t.indexOf("."),n=t.substring(0,-1===s?void 0:s);let i;-1!==s&&(i=t.substring(s+1)),"org"===i?(async e=>{try{const t=await fetch(`${Ge}/${e}`);if(200!==t.status)throw new Error(r("header.open.importFailContent"));const s=await t.json();d(s),l(),u&&he.event(ze.IMPORT_WORK_FROM_SHARE,{share:e}),he.sendNotification({title:r("header.open.importOK",{id:e}),message:r("header.open.importOKContent"),type:"success",duration:9e3})}catch(t){he.sendNotification({title:r("header.open.importFail",{id:e}),message:t.message,type:"error",duration:9e3})}})(n):x(n,i),he.updateAppMetadata({search:""})}},[]),Ut.useEffect(()=>(Qs.onmessage=e=>{const{event:t,data:s}=e.data;t===Xs&&(x(s),n())},()=>Qs.close()),[]),s.jsxs(s.Fragment,{children:[s.jsxs($e,{isOpen:t,onClose:n,size:"full",sx:en,children:[s.jsx("iframe",{src:"/rmp-gallery/",loading:"lazy"}),s.jsx(G,{onClick:n,position:"fixed",top:"5px",right:"15px"})]}),s.jsx(Ys,{isOpen:o,onClose:a,onConfirm:async()=>{c&&await(async e=>{const{version:t,...s}=JSON.parse(await Fe(JSON.stringify(e)));i(He()),p.current.clear(),p.current.import(s.graph),g();const{svgViewBoxZoom:n,svgViewBoxMin:r}=s;"number"==typeof n&&i(Ue(n)),"number"==typeof r.x&&"number"==typeof r.y&&i(Ve(r))})(c),a(),d(null)}})]})}function sn(){const e=we(),{t:t}=Ht(),{isOpen:n,onOpen:r,onClose:i}=$(),[o,l]=Ut.useState(null),a=Pe(),{height:c}=Ie(a),d=Ut.useRef(window.graph),h=Ut.useRef(null),[u,p]=Ut.useState(!1),[g,x]=Ut.useState(!1),m=Ut.useCallback(()=>{e(Be()),e(We()),e(De(d.current.export()))},[e,Be,We,De,d]),j=async t=>{const{version:s,...n}=JSON.parse(await Fe(t));e(He()),d.current.clear(),d.current.import(n.graph),m();const{svgViewBoxZoom:r,svgViewBoxMin:i}=n;"number"==typeof r&&e(Ue(r)),"number"==typeof i.x&&"number"==typeof i.y&&e(Ve(i))};return Ut.useEffect(()=>{const e=async e=>{const{type:t,key:s,from:n}=e.data;if(t===Qe.SAVE_CHANGED&&s===et.PARAM&&"rmt"===n){tt.debug(`Received save changed event on key: ${s}`);const e=localStorage.getItem(et.PARAM);if(!e)return;await j(e)}};return Ye.addEventListener("message",e),()=>Ye.removeEventListener("message",e)},[]),s.jsxs(s.Fragment,{children:[s.jsxs(O,{children:[s.jsx(z,{as:E,size:"sm",variant:"ghost",icon:s.jsx(Je,{})}),s.jsxs(A,{children:[s.jsx(M,{icon:s.jsx(Ke,{}),onClick:()=>{e(He()),d.current.clear(),e(Ue(100)),e(Ve({x:0,y:0})),m()},children:t("header.open.new")}),s.jsx("input",{id:"upload_project",ref:h,type:"file",accept:".json",hidden:!0,onChange:async s=>{const n=s.target.files?.[0];if(console.log("OpenActions.handleUpload():: received file",n),"application/json"!==n?.type)e(Ae({status:"error",message:t("header.open.invalidType")})),console.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const e=await nn(n);l(e),r()}catch(i){e(Ae({status:"error",message:t("header.open.unknownError")})),console.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",i)}s.target.value=""},"data-testid":"file-upload"}),s.jsx(M,{icon:s.jsx(Je,{}),onClick:()=>h?.current?.click(),children:t("header.open.config")}),s.jsx(M,{icon:s.jsx(Ze,{}),onClick:()=>p(!0),children:t("header.open.projectRMG")}),s.jsxs(M,{icon:s.jsx(be,{}),onClick:()=>x(!0),children:[t("header.open.gallery"),s.jsx(N,{ml:"1",colorScheme:"green",children:"New"})]}),s.jsx(M,{icon:s.jsx(qe,{}),onClick:async()=>{const e=await Xe();l(e),r()},children:t("header.open.tutorial")})]}),s.jsx(qs,{isOpen:u,onClose:()=>p(!1)}),s.jsx(tn,{isOpen:g,onClose:()=>x(!1)})]}),s.jsx(Ys,{isOpen:n,onClose:i,onConfirm:async()=>{if(o){await j(o);const t=await Xe();if(o.length===t.length){e(Ve({x:-10,y:-13}));const t=Math.max(0,Math.min(400,-.132*c+117.772));e(Ue(t)),he.event(ze.LOAD_TUTORIAL,{})}}i(),l(null)}})]})}const nn=e=>new Promise(t=>{const s=new FileReader;s.onloadend=()=>t(s.result),s.readAsText(e)}),rn=()=>{const[e,t]=Ut.useState(!1),{t:n}=Ht(),r=we(),i=Ut.useRef(window.graph),o=Pe(),{width:l,height:a}=Ie(o),[c,d]=Ut.useState([]);return Ut.useEffect(()=>{e&&d(i.current.nodes().filter(e=>e.startsWith("stn")).map(e=>{const t=i.current.getNodeAttributes(e);return{id:e,value:t[t.type].names.join("/")}}))},[e]),s.jsxs(F,{isOpen:e,onOpen:()=>t(!0),onClose:()=>t(!1),children:[s.jsx(H,{children:s.jsx(E,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:s.jsx(st,{}),onClick:()=>t(!e)})}),s.jsx(U,{children:s.jsx(V,{children:s.jsx(nt,{label:n("header.search"),children:s.jsx(rt,{data:c,displayHandler:e=>s.jsx(N,{children:e.value}),filter:(e,t)=>t.value.toLowerCase().includes(e.toLowerCase())||Object.values(t.value).some(t=>t.toLowerCase().includes(e.toLowerCase())),value:"",onChange:e=>(e=>{r(it(new Set([e])));const t=Math.max(0,Math.min(400,-.132*a+117.772)),{x:s,y:n}=ot((l-300)/2,a/2,t,{x:-i.current.getNodeAttribute(e,"x"),y:-i.current.getNodeAttribute(e,"y")});r(Ue(t)),r(Ve({x:-s,y:-n}))})(e.id)})})})})]})},on=[me.ShmetroBasic2020,me.LondonTubeBasic,me.ShanghaiSuburbanRailway],ln=(e,t,s,n)=>n.filter(s=>"any"===t||e.getNodeAttribute(s,"type")===t).forEach(t=>{((e,t,s)=>{const n=e.getNodeAttribute(t,"type"),r=structuredClone(e.getNodeAttribute(t,n).names);for(let o=0;o<Math.abs(qt[s].defaultAttrs.names.length-r.length);o++)qt[s].defaultAttrs.names.length>r.length?r.push("Stn"):r.pop();const i={...qt[s].defaultAttrs,names:r};Object.values(on).includes(n)&&Object.values(on).includes(s)||(i.nameOffsetX=e.getNodeAttribute(t,n).nameOffsetX,i.nameOffsetY=e.getNodeAttribute(t,n).nameOffsetY),ge.has(s)&&ge.has(n)&&(i.color=structuredClone(e.getNodeAttribute(t,n).color)),e.removeNodeAttribute(t,n),e.mergeNodeAttributes(t,{type:s,[s]:i})})(e,t,s)}),an=(e,t,s,n,r)=>n.filter(s=>"any"===t||e.getEdgeAttribute(s,"type")===t).forEach(t=>{((e,t,s,n)=>{const r=e.getEdgeAttribute(t,"type"),i=e.getEdgeAttribute(t,"style");if(lt[i].metadata.supportLinePathType.includes(s)){const i=structuredClone(Le[s].defaultAttrs);let o=-1;if(n&&s!==Ne.Simple){const[n,r]=e.extremities(t),l=i.startFrom;o=Re(e,s,n,r,l)}e.setEdgeAttribute(t,"parallelIndex",o),e.removeEdgeAttribute(t,r),e.mergeEdgeAttributes(t,{type:s,[s]:i})}})(e,t,s,r)}),cn=(e,t,s,n,r)=>r.filter(s=>"any"===t||e.getEdgeAttribute(s,"style")===t).forEach(t=>{((e,t,s,n)=>{const r=e.getEdgeAttribute(t,"type"),i=e.getEdgeAttribute(t,"style");if(lt[s].metadata.supportLinePathType.includes(r)){const r=e.getEdgeAttribute(t,"zIndex"),o=e.getEdgeAttribute(t,i);e.removeEdgeAttribute(t,i);const l=structuredClone(lt[s].defaultAttrs);ge.has(i)&&ge.has(s)?l.color=o.color:ge.has(s)&&n&&(l.color=n),e.mergeEdgeAttributes(t,{style:s,[s]:l}),s===Te.River?e.setEdgeAttribute(t,"zIndex",-5):e.setEdgeAttribute(t,"zIndex",r??0)}})(e,t,s,n)}),dn=e=>{const{isOpen:t,onClose:c,isSelect:d,filter:p}=e,{t:g}=Ht(),x=we(),{selected:m}=ye(e=>e.runtime),{preference:{autoParallel:j}}=ye(e=>e.app),{activeSubscriptions:f}=ye(e=>e.account),y=Ut.useCallback(()=>{x(Be()),x(We()),x(De(C.current.export()))},[x,Be,We,De]),C=Ut.useRef(window.graph),S={any:g("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(Le).map(([e,t])=>[e,g(t.metadata.displayName).toString()]))},v={any:g("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(lt).map(([e,t])=>[e,g(t.metadata.displayName).toString()]))},_={any:g("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(qt).map(([e,t])=>[e,g(t.metadata.displayName).toString()]))},k={id:"any",theme:[ue.Other,"other","#ffffff",pe.black],value:g("header.settings.procedures.changeType.any")},[O,z]=Ut.useState(!1),[E,A]=Ut.useState(0),[M,N]=Ut.useState(!1),[R,T]=Ut.useState("any"),[L,P]=Ut.useState(me.ShmetroBasic),[I,B]=Ut.useState(!1),[W,D]=Ut.useState("any"),[$,G]=Ut.useState(Te.SingleColor),[F,H]=Ut.useState(!1),[U,V]=Ut.useState("any"),[Q,ee]=Ut.useState(Ne.Diagonal),[te,se]=Ut.useState(!1),[ne,re]=Ut.useState(k),{theme:ie,requestThemeChange:oe}=at(),[le,ae]=Ut.useState([]),ce=[{id:"changeZIndex",title:g("header.settings.procedures.changeZIndex"),onClose:()=>z(!O),field:[{type:"select",label:g("panel.details.info.zIndex"),value:E,options:Object.fromEntries(Array.from({length:11},(e,t)=>[t-5,(t-5).toString()])),onChange:e=>A(Number(e))}]},{id:"changeStationType",title:g("header.settings.procedures.changeStationType.title"),onClose:()=>N(!M),field:[{type:"select",label:g("header.settings.procedures.changeStationType.changeFrom"),options:_,value:R,disabledOptions:[L],onChange:e=>T(e)},{type:"select",label:g("header.settings.procedures.changeStationType.changeTo"),options:_,value:L,disabledOptions:["any",R],onChange:e=>P(e)}]},{id:"changeLineStyleType",title:g("header.settings.procedures.changeLineStyleType.title"),onClose:()=>B(!I),field:[{type:"select",label:g("header.settings.procedures.changeLineStyleType.changeFrom"),options:v,value:W,disabledOptions:[$],onChange:e=>D(e)},{type:"select",label:g("header.settings.procedures.changeLineStyleType.changeTo"),options:v,value:$,disabledOptions:["any",W],onChange:e=>G(e)}]},{id:"changeLinePathType",title:g("header.settings.procedures.changeLinePathType.title"),onClose:()=>H(!F),field:[{type:"select",label:g("header.settings.procedures.changeLinePathType.changeFrom"),options:S,value:U,disabledOptions:[Q],onChange:e=>V(e)},{type:"select",label:g("header.settings.procedures.changeLinePathType.changeTo"),options:S,value:Q,disabledOptions:["any","simple",U],onChange:e=>ee(e)}]},{id:"changeColor",title:g("header.settings.procedures.changeColor.title"),onClose:()=>se(!te),field:[{type:"custom",label:g("header.settings.procedures.changeColor.changeFrom"),component:s.jsx(rt,{data:le,displayHandler:e=>s.jsx(je,{name:e.value,fg:e.theme[3],bg:e.theme[2],title:e.theme[1],sx:{display:"inline-block",overflow:"hidden",textOverflow:"ellipsis"}}),filter:(e,t)=>t.id.toLowerCase().includes(e.toLowerCase())||Object.values(t.id).some(t=>t.toLowerCase().includes(e.toLowerCase())),value:ne.value,onChange:e=>re(e)})},{type:"custom",label:g("header.settings.procedures.changeColor.changeTo"),component:s.jsx(ct,{theme:ie,onClick:oe})}]}];return Ut.useEffect(()=>{t&&(z(!1),N(!1),B(!1),H(!1),se(!1),A(0),ae([k,...Xt(C.current,d?[...m].filter(e=>e.startsWith("stn")||e.startsWith("misc_node")):C.current.nodes(),d?[...m].filter(e=>e.startsWith("line")):C.current.edges()).map(e=>({id:e.toString(),theme:e,value:"other"===e[1]?e[2]:e[1]}))]),re(k))},[t]),s.jsxs(n,{isOpen:t,onClose:c,size:"md",scrollBehavior:"inside",children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsxs(o,{children:[s.jsx(h,{as:"b",fontSize:"xl",children:g(d?"panel.details.multipleSelection.change":"header.settings.procedures.changeType.title")}),s.jsx(l,{})]}),s.jsx(a,{children:s.jsx(Y,{allowMultiple:!0,children:ce.map(e=>s.jsxs(J,{children:[s.jsxs(K,{onClick:e.onClose,children:[s.jsx(u,{as:"span",flex:"1",textAlign:"left",children:s.jsx(h,{as:"b",fontSize:"md",children:e.title})}),s.jsx(Z,{})]}),s.jsx(q,{pb:4,children:s.jsx(Oe,{fields:e.field,minW:270})})]},e.id))})}),s.jsxs(w,{children:[s.jsx(b,{colorScheme:"blue",variant:"outline",mr:"1",onClick:c,children:g("cancel")}),s.jsx(X,{label:g("header.settings.pro"),isOpen:!f.RMP_CLOUD,children:s.jsx(b,{colorScheme:"red",mr:"1",onClick:()=>{const e=p?.includes("station")?[...m].filter(e=>e.startsWith("stn")):d?[]:C.current.filterNodes(e=>e.startsWith("stn")),t=p?.includes("misc-node")?[...m].filter(e=>e.startsWith("misc_node")):d?[]:C.current.filterNodes(e=>e.startsWith("misc_node")),s=d?[...m].filter(e=>e.startsWith("line")):C.current.edges();p&&!p.includes("station")||!M||ln(C.current,R,L,e),p&&!p.includes("line")||!I||cn(C.current,W,$,ie,s),p&&!p.includes("line")||!F||an(C.current,U,Q,s,j),te&&(p&&!p.includes("line")||((e,t,s,n)=>{n.filter(t=>ge.has(e.getEdgeAttribute(t,"style"))).forEach(n=>{const r=e.getEdgeAttributes(n),i=r[r.style].color;("any"===t||i[0]==t[0]&&i[1]==t[1]&&i[2]==t[2]&&i[3]==t[3])&&e.mergeEdgeAttributes(n,{[r.style]:{color:s}})})})(C.current,"any"===ne.id?"any":ne.theme,ie,s),(!p||p.includes("misc-node")||p.includes("station"))&&((e,t,s,n,r)=>{[...n,...r].forEach(n=>{const r=e.getNodeAttributes(n).type,i=e.getNodeAttribute(n,r);if(void 0!==i.color){const e=i.color;("any"===t||e[0]==t[0]&&e[1]==t[1]&&e[2]==t[2]&&e[3]==t[3])&&(i.color=s)}e.mergeNodeAttributes(n,{[r]:i})})})(C.current,"any"===ne.id?"any":ne.theme,ie,e,t)),O&&((e,t,s,n,r)=>{[...t,...s].forEach(t=>{e.setNodeAttribute(t,"zIndex",r)}),n.forEach(t=>{e.setEdgeAttribute(t,"zIndex",r)})})(C.current,e,t,s,E),y(),c()},isDisabled:!(f.RMP_CLOUD&&(O||M||I||F||te)),children:g("apply")})})]})]})]})},hn=e=>{const{isOpen:t,onClose:c}=e,d=we(),{t:h}=Ht(),u=Ut.useRef(window.graph),{theme:p,requestThemeChange:g}=at();return s.jsxs(n,{isOpen:t,onClose:c,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:h("header.settings.procedures.removeLines.title")}),s.jsx(l,{}),s.jsxs(a,{children:[h("header.settings.procedures.removeLines.content"),s.jsx(ct,{theme:p,onClick:g})]}),s.jsxs(w,{children:[s.jsx(b,{colorScheme:"blue",variant:"outline",mr:"1",onClick:c,children:h("cancel")}),s.jsx(b,{colorScheme:"red",onClick:()=>{u.current.filterEdges((e,t,s,n,r,i,o)=>ge.has(t.style)&&JSON.stringify(t[t.style].color)===JSON.stringify(p)).forEach(e=>u.current.dropEdge(e)),d(We()),d(De(u.current.export())),c()},children:h("remove")})]})]})]})},un=e=>{const{isOpen:t,onClose:c}=e,d=we(),{t:h}=Ht(),u=Ut.useRef(window.graph),[p,g]=Ut.useState(1),x=[{type:"input",label:h("header.settings.procedures.scale.factor"),value:p.toString(),variant:"number",onChange:e=>g(Number(e)),minW:"full"}];return s.jsxs(n,{isOpen:t,onClose:c,size:"xl",scrollBehavior:"inside",children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:h("header.settings.procedures.scale.title")}),s.jsx(l,{}),s.jsxs(a,{children:[h("header.settings.procedures.scale.content"),s.jsx(Oe,{fields:x})]}),s.jsxs(w,{children:[s.jsx(b,{colorScheme:"blue",variant:"outline",mr:"1",onClick:c,children:h("cancel")}),s.jsx(b,{colorScheme:"red",onClick:()=>{u.current.forEachNode((e,t)=>{u.current.updateNodeAttribute(e,"x",e=>(e??0)*p),u.current.updateNodeAttribute(e,"y",e=>(e??0)*p)}),d(Be()),d(We()),d(De(u.current.export())),c()},children:h("apply")})]})]})]})},pn=e=>{const{isOpen:t,onClose:c}=e,d=we(),{t:h}=Ht(),u=Ut.useRef(window.graph),[p,g]=Ut.useState(0),[x,m]=Ut.useState(0),j=[{type:"input",label:h("header.settings.procedures.translate.x"),value:p.toString(),variant:"number",onChange:e=>g(Number(e)),minW:"full"},{type:"input",label:h("header.settings.procedures.translate.y"),value:x.toString(),variant:"number",onChange:e=>m(Number(e)),minW:"full"}];return s.jsxs(n,{isOpen:t,onClose:c,size:"xl",scrollBehavior:"inside",children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:h("header.settings.procedures.translate.title")}),s.jsx(l,{}),s.jsxs(a,{children:[h("header.settings.procedures.translate.content"),s.jsx(Oe,{fields:j})]}),s.jsxs(w,{children:[s.jsx(b,{colorScheme:"blue",variant:"outline",mr:"1",onClick:c,children:h("cancel")}),s.jsx(b,{colorScheme:"red",onClick:()=>{u.current.forEachNode((e,t)=>{u.current.updateNodeAttribute(e,"x",e=>(e??0)+p),u.current.updateNodeAttribute(e,"y",e=>(e??0)+x)}),d(Be()),d(We()),d(De(u.current.export())),c()},children:h("apply")})]})]})]})},gn=e=>{const{isOpen:t,onClose:c}=e,d=we(),{preference:{unlockSimplePathAttempts:u}}=ye(e=>e.app),{activeSubscriptions:p}=ye(e=>e.account),{t:g}=Ht();return s.jsxs(n,{isOpen:t,onClose:c,size:"5xl",scrollBehavior:"inside",children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:g("header.settings.procedures.unlockSimplePath.title")}),s.jsx(l,{}),s.jsxs(a,{children:[s.jsx(h,{mb:"2",children:g("header.settings.procedures.unlockSimplePath.content1")}),s.jsx(h,{mb:"2",children:g("header.settings.procedures.unlockSimplePath.content2")}),s.jsx(h,{mb:"2",children:g("header.settings.procedures.unlockSimplePath.content3")})]}),s.jsx(w,{children:s.jsx(X,{label:g("header.settings.pro"),isOpen:!p.RMP_CLOUD&&u>=0,children:s.jsx(b,{onClick:()=>{d(dt(-1))},isDisabled:!p.RMP_CLOUD||u<0,children:g(u>=0?"header.settings.procedures.unlockSimplePath.check":"header.settings.procedures.unlockSimplePath.unlocked")})})})]})]})},xn=e=>{const{isOpen:t,onClose:c}=e,d=we(),u=Q(),{t:p}=Ht(),g=Ut.useRef(window.graph),[x,m]=Ut.useState(!1);return s.jsxs(n,{isOpen:t,onClose:c,size:"xl",scrollBehavior:"inside",children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:p("header.settings.procedures.updateColor.title")}),s.jsx(l,{}),s.jsx(a,{children:s.jsx(h,{children:p("header.settings.procedures.updateColor.content")})}),s.jsxs(w,{children:[s.jsx(b,{colorScheme:"blue",variant:"outline",mr:"1",onClick:c,children:p("cancel")}),s.jsx(b,{colorScheme:"red",onClick:async()=>{m(!0);const e=JSON.stringify(g.current.export());try{const t=await fn(e);g.current.clear(),g.current.import(t),d(Be()),d(We()),d(De(g.current.export())),u({title:p("header.settings.procedures.updateColor.success"),status:"success",duration:9e3,isClosable:!0})}catch(t){console.error(`[rmp] Error in updating all colors: ${t}`),u({title:p("header.settings.procedures.updateColor.error",{e:t}),status:"error",duration:9e3,isClosable:!0})}m(!1),c()},isLoading:x,children:p("apply")})]})]})]})},mn=e=>e.length>=4&&e.every(e=>"string"==typeof e)&&!!e[2].match(/^#[0-9a-fA-F]{6}$/)&&Object.values(pe).includes(e[3]),jn=(e,t,s)=>{const n=t.split(".");let r=e;for(let i=0;i<n.length-1;i++)r=r[n[i]];r[n[n.length-1]]=s},fn=async e=>{const t=JSON.parse(e),s=(new Date).getTime(),n=(e=>{const t=[],s=(e,n)=>{if(Array.isArray(e)&&mn(e))t.push({path:n||"",value:e});else for(const r in e){const i=e[r],o=n?`${n}.${r}`:r;Array.isArray(i)?mn(i)?t.push({path:o,value:i}):i.forEach((e,t)=>s(e,`${o}.${t}`)):i&&"object"==typeof i&&s(i,o)}};return s(e),t})(t);console.log("[rmp] Found all themes pending for update",n);let r,i=!1;const o=new Promise((e,s)=>{r=setTimeout(()=>{i=!0,s("Executing time exceeds 10000ms")},1e4),(async()=>{for(const{path:e,value:s}of n){if(i)throw new Error("Update aborted");const[n,r,o,l,...a]=s,c=await ht([n,r,o,l]);jn(t,e,[...c,...a])}})().then(e).catch(s)});try{return await o,console.log(`[rmp] Themes update completed, elapsed time ${((new Date).getTime()-s)/1e3} sec`),t}finally{clearTimeout(r)}},bn=()=>{const e=we(),{state:t,token:n}=ye(e=>e.account),{count:{stations:r,miscNodes:i,masters:o,lines:l,parallel:a}}=ye(e=>e.runtime),{t:c}=Ht(),[d,p]=Ut.useState(!1),[g,x]=Ut.useState(1);Ut.useEffect(()=>{let e;return d&&g>0?e=window.setTimeout(()=>{x(g-1)},1e3):0===g&&p(!1),()=>clearTimeout(e)},[d,g]);const m={"logged-out":c("header.settings.status.subscription.logged-out"),free:c("header.settings.status.subscription.free"),subscriber:c("header.settings.status.subscription.subscriber"),expired:c("header.settings.status.subscription.expired")};return s.jsxs(u,{width:"100%",mb:"3",children:[s.jsx(h,{as:"b",fontSize:"xl",children:c("header.settings.status.title")}),s.jsxs(u,{mt:"3",children:[s.jsxs(u,{mb:"1",children:[s.jsxs(u,{display:"flex",mb:"1",children:[s.jsx(h,{flex:"1",children:c("header.settings.status.count.stations")}),s.jsx(h,{children:r})]}),s.jsxs(u,{display:"flex",mb:"1",children:[s.jsx(h,{flex:"1",children:c("header.settings.status.count.miscNodes")}),s.jsx(h,{children:i})]}),s.jsxs(u,{display:"flex",mb:"1",children:[s.jsx(h,{flex:"1",children:c("header.settings.status.count.masters")}),s.jsx(h,{children:o})]}),s.jsxs(u,{display:"flex",mb:"1",children:[s.jsx(h,{flex:"1",children:c("header.settings.status.count.lines")}),s.jsx(h,{children:l})]}),s.jsxs(u,{display:"flex",mb:"1",children:[s.jsx(h,{flex:"1",children:c("header.settings.status.count.parallel")}),s.jsx(h,{children:a})]})]}),s.jsxs(u,{display:"flex",mb:"1",children:[s.jsxs(h,{flex:"1",children:[c("header.settings.status.subscription.content")," ",m[t]]}),s.jsx(E,{"aria-label":"refresh",variant:"ghost",size:"sm",icon:s.jsx(ut,{}),isDisabled:d,onClick:()=>(p(!0),x(1),void(n&&pt(e,n)))})]})]})]})},wn={width:"100%",justifyContent:"space-between"},yn={fontFamily:"-apple-system"},Cn=e=>{const{isOpen:t,onClose:c}=e,{activeSubscriptions:d}=ye(e=>e.account),{telemetry:{project:p},preference:{autoParallel:x,randomStationsNames:m,gridLines:j,snapLines:f}}=ye(e=>e.app),{keepLastPath:w,count:{parallel:y}}=ye(e=>e.runtime),C=we(),{t:S}=Ht(),O=k("primary.500","primary.300"),[z,E]=Ut.useState(!1),[A,M]=Ut.useState(!1),[R,T]=Ut.useState(!1),[L,P]=Ut.useState(!1),[I,B]=Ut.useState(!1),[W,D]=Ut.useState(!1),[$,G]=Ut.useState(!1),F=he.isAllowAnalytics(),H=y>=(d.RMP_CLOUD?gt:xt),U=!d.RMP_CLOUD;return s.jsxs(n,{isOpen:t,onClose:c,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:S("header.settings.title")}),s.jsx(l,{}),s.jsx(a,{children:s.jsxs(g,{divider:s.jsx(ce,{borderColor:"gray.200"}),children:[s.jsx(bn,{}),s.jsxs(u,{width:"100%",mb:"3",children:[s.jsx(h,{as:"b",fontSize:"xl",children:S("header.settings.preference.title")}),s.jsxs(u,{mt:"3",children:[s.jsxs(u,{display:"flex",mb:"1",children:[s.jsx(h,{flex:"1",children:S("header.settings.preference.keepLastPath")}),s.jsx(ee,{isChecked:w,onChange:({target:{checked:e}})=>C(mt(e))})]}),s.jsxs(u,{display:"flex",mb:"1",children:[s.jsx(h,{children:S("header.settings.preference.autoParallel")}),s.jsx(N,{ml:"auto",colorScheme:"green",children:"New"}),s.jsx(X,{label:S("header.settings.proWithTrial"),children:s.jsx(N,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),s.jsx(ee,{ml:"1",isDisabled:H,isChecked:x,onChange:({target:{checked:e}})=>C(jt(e))})]}),s.jsxs(u,{mb:"1",display:"flex",children:[s.jsx(h,{flex:"1",children:S("header.settings.preference.randomStationNames.title")}),s.jsx(N,{ml:"auto",colorScheme:"green",children:"New"}),s.jsx(X,{label:S("header.settings.pro"),children:s.jsx(N,{color:"gray.50",ml:"1",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),s.jsxs(te,{size:"xs",width:"auto",ml:"1",value:m,onChange:e=>{C(Ot(e.target.value))},children:[s.jsx("option",{value:"none",children:S("header.settings.preference.randomStationNames.none")}),s.jsx("option",{value:ft.Shmetro,disabled:U,children:S(`header.settings.preference.randomStationNames.${ft.Shmetro}`)}),s.jsx("option",{value:ft.Bjsubway,disabled:U,children:S(`header.settings.preference.randomStationNames.${ft.Bjsubway}`)})]})]}),s.jsxs(u,{display:"flex",mb:"1",children:[s.jsx(h,{flex:"1",children:S("header.settings.preference.gridline")}),s.jsx(ee,{isChecked:j,onChange:({target:{checked:e}})=>C(bt(e))})]}),s.jsxs(u,{display:"flex",mb:"1",children:[s.jsx(h,{flex:"1",children:S("header.settings.preference.snapline")}),s.jsx(ee,{isChecked:f,onChange:({target:{checked:e}})=>C(wt(e))})]})]})]}),s.jsxs(u,{width:"100%",mb:"3",children:[s.jsx(h,{as:"b",fontSize:"xl",children:S("header.settings.procedures.title")}),s.jsxs(u,{mt:"3",children:[s.jsx(b,{sx:wn,rightIcon:s.jsx(yt,{}),onClick:()=>E(!0),children:S("header.settings.procedures.translate.title")}),s.jsx(pn,{isOpen:z,onClose:()=>E(!1)}),s.jsx(b,{sx:wn,rightIcon:s.jsx(yt,{}),onClick:()=>M(!0),children:S("header.settings.procedures.scale.title")}),s.jsx(un,{isOpen:A,onClose:()=>M(!1)}),s.jsxs(b,{sx:wn,rightIcon:s.jsx(yt,{}),onClick:()=>T(!0),children:[S("header.settings.procedures.changeType.title"),s.jsx(X,{label:S("header.settings.pro"),children:s.jsx(N,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),s.jsx(dn,{isOpen:R,onClose:()=>T(!1),isSelect:!1}),s.jsx(b,{sx:wn,rightIcon:s.jsx(yt,{}),onClick:()=>P(!0),children:S("header.settings.procedures.removeLines.title")}),s.jsx(hn,{isOpen:L,onClose:()=>P(!1)}),s.jsx(b,{sx:wn,rightIcon:s.jsx(yt,{}),onClick:()=>B(!0),children:S("header.settings.procedures.updateColor.title")}),s.jsx(xn,{isOpen:I,onClose:()=>B(!1)}),s.jsxs(b,{sx:wn,rightIcon:s.jsx(yt,{}),onClick:()=>D(!0),children:[S("header.settings.procedures.unlockSimplePath.title"),s.jsx(X,{label:S("header.settings.pro"),children:s.jsx(N,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),s.jsx(gn,{isOpen:W,onClose:()=>D(!1)}),s.jsx(b,{sx:wn,rightIcon:s.jsx(yt,{}),onClick:()=>G(!0),children:S("header.settings.procedures.masterManager.title")}),s.jsx(Qt,{isOpen:$,onClose:()=>G(!1)})]})]}),s.jsxs(u,{width:"100%",mb:"3",children:[s.jsx(h,{as:"b",fontSize:"xl",children:S("header.settings.shortcuts.title")}),s.jsx(u,{mt:"3",children:s.jsxs(se,{children:[s.jsx(ne,{children:s.jsxs(re,{children:[s.jsx(ie,{children:S("header.settings.shortcuts.keys")}),s.jsx(ie,{children:S("header.settings.shortcuts.description")})]})}),s.jsxs(oe,{children:[s.jsxs(re,{children:[s.jsx(le,{children:s.jsx(ae,{children:"f"})}),s.jsx(le,{children:S("header.settings.shortcuts.f")})]}),s.jsxs(re,{children:[s.jsx(le,{children:s.jsx(ae,{children:"s"})}),s.jsx(le,{children:S("header.settings.shortcuts.s")})]}),s.jsxs(re,{children:[s.jsx(le,{children:s.jsxs(u,{display:"flex",flexDirection:"row",children:[s.jsx(Ct,{}),s.jsx(St,{}),s.jsx(vt,{}),s.jsx(_t,{})]})}),s.jsx(le,{children:S("header.settings.shortcuts.arrows")})]}),s.jsxs(re,{children:[s.jsx(le,{children:s.jsxs(u,{display:"flex",flexDirection:"row",children:[s.jsx(ae,{children:"i"}),s.jsx(ae,{children:"j"}),s.jsx(ae,{children:"k"}),s.jsx(ae,{children:"l"})]})}),s.jsx(le,{children:S("header.settings.shortcuts.ijkl")})]}),s.jsxs(re,{children:[s.jsx(le,{children:kt?s.jsx(ae,{sx:yn,children:"⇧"}):s.jsx(ae,{children:"shift"})}),s.jsx(le,{children:S("header.settings.shortcuts.shift")})]}),s.jsxs(re,{children:[s.jsx(le,{children:kt?s.jsx(ae,{sx:yn,children:"⌥"}):s.jsx(ae,{children:"alt"})}),s.jsx(le,{children:S("header.settings.shortcuts.alt")})]}),s.jsxs(re,{children:[s.jsx(le,{children:kt?s.jsx(ae,{sx:yn,children:"⌫"}):s.jsx(ae,{children:"delete"})}),s.jsx(le,{children:S("header.settings.shortcuts.delete")})]}),s.jsxs(re,{children:[s.jsxs(le,{children:[kt?s.jsx(ae,{sx:yn,children:"⌘"}):s.jsx(ae,{children:"ctrl"})," + ",s.jsx(ae,{children:"x"})]}),s.jsx(le,{children:S("header.settings.shortcuts.cut")})]}),s.jsxs(re,{children:[s.jsxs(le,{children:[kt?s.jsx(ae,{sx:yn,children:"⌘"}):s.jsx(ae,{children:"ctrl"})," + ",s.jsx(ae,{children:"c"})]}),s.jsx(le,{children:S("header.settings.shortcuts.copy")})]}),s.jsxs(re,{children:[s.jsxs(le,{children:[kt?s.jsx(ae,{sx:yn,children:"⌘"}):s.jsx(ae,{children:"ctrl"})," + ",s.jsx(ae,{children:"v"})]}),s.jsx(le,{children:S("header.settings.shortcuts.paste")})]}),s.jsxs(re,{children:[s.jsxs(le,{children:[kt?s.jsx(ae,{sx:yn,children:"⌘"}):s.jsx(ae,{children:"ctrl"})," + ",s.jsx(ae,{children:"z"})]}),s.jsx(le,{children:S("header.settings.shortcuts.undo")})]}),s.jsxs(re,{children:[s.jsx(le,{children:kt?s.jsxs(s.Fragment,{children:[s.jsx(ae,{sx:yn,children:"⇧"})," + ",s.jsx(ae,{sx:yn,children:"⌘"})," + ",s.jsx(ae,{children:"z"})]}):s.jsxs(s.Fragment,{children:[s.jsx(ae,{children:"ctrl"})," + ",s.jsx(ae,{children:"y"})]})}),s.jsx(le,{children:S("header.settings.shortcuts.redo")})]})]})]})})]}),s.jsxs(u,{width:"100%",mb:"3",children:[s.jsx(h,{as:"b",fontSize:"xl",children:S("header.settings.telemetry.title")}),s.jsxs(u,{mt:"3",children:[s.jsx(h,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:S("header.settings.telemetry.info")}),s.jsxs(u,{mt:"3",mb:"1",children:[s.jsxs(u,{display:"flex",mb:"1",children:[s.jsx(h,{flex:"1",children:S("header.settings.telemetry.essential")}),s.jsx(X,{label:S("header.settings.telemetry.essentialTooltip"),children:s.jsx(ee,{isChecked:F,isDisabled:!0})})]}),s.jsx(h,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:S("header.settings.telemetry.essentialInfo")}),s.jsxs(v,{color:O,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[S("header.settings.telemetry.essentialLink")," ",s.jsx(_,{as:be})]})]}),s.jsxs(u,{mt:"1",mb:"1",children:[s.jsxs(u,{display:"flex",children:[s.jsx(h,{flex:"1",children:S("header.settings.telemetry.additional")}),s.jsx(ee,{isChecked:p,onChange:({target:{checked:e}})=>{C(zt(e))}})]}),s.jsx(h,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:S("header.settings.telemetry.additionalInfo")})]})]})]})]})})]})]})},Sn=()=>{const[e,t]=Ut.useState(!1),{svgViewBoxZoom:n}=ye(e=>e.param),r=we(),i=[{type:"slider",label:"",value:400-n,min:10,max:390,step:1,onChange:e=>r(Ue(400-e)),leftIcon:s.jsx(At,{}),rightIcon:s.jsx(Et,{}),minW:160}];return s.jsxs(F,{isOpen:e,onOpen:()=>t(!0),onClose:()=>t(!1),children:[s.jsx(H,{children:s.jsx(E,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:s.jsx(Et,{}),onClick:()=>t(!e)})}),s.jsx(U,{children:s.jsx(V,{children:s.jsx(Oe,{fields:i,noLabel:!0})})})]})};function vn(){const{t:e}=Ht(),n=we(),{past:r,future:i}=ye(e=>e.param),o=he.isAllowAnalytics(),[l,a]=Ut.useState(!1),[d,h]=Ut.useState(!1),u=t(he.getEnv),g=t(he.getAppVersion),x=Mt();return Ut.useEffect(()=>{o&&u!==Nt.DEV&&he.event(ze.APP_LOAD,{isStandaloneWindow:he.isStandaloneWindow()})},[u]),s.jsxs(Rt,{children:[s.jsxs(c,{direction:"landscape"===x?"row":"column",width:"100%",children:[s.jsxs(B,{height:"32px",children:[s.jsx(p,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:e("header.about.rmp")}),s.jsx(Tt,{environment:u,version:g,popoverHeader:u===Nt.PRD?void 0:s.jsxs(Vt,{i18nKey:"header.popoverHeader",environment:u,children:["You're on ",{environment:u}," environment!"]}),popoverBody:u===Nt.PRD?void 0:s.jsx(Vt,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})})]}),s.jsxs(B,{overflowX:"auto",ml:"landscape"===x?"auto":void 0,children:[s.jsx(rn,{}),s.jsx(E,{size:"sm",variant:"ghost","aria-label":"Undo",icon:s.jsx(Lt,{}),isDisabled:0===r.length,onClick:()=>{n($t()),n(Be()),n(We())}}),s.jsx(E,{size:"sm",variant:"ghost","aria-label":"Redo",icon:s.jsx(Pt,{}),isDisabled:0===i.length,onClick:()=>{n(Gt()),n(Be()),n(We())}}),s.jsx(Sn,{}),s.jsx(sn,{}),s.jsx(Vs,{}),he.isStandaloneWindow()&&s.jsxs(O,{children:[s.jsx(z,{as:E,icon:s.jsx(It,{}),variant:"ghost",size:"sm"}),s.jsx(A,{children:["en","zh-Hans","zh-Hant","ja","ko"].map(e=>s.jsx(M,{onClick:()=>{return t=e,void he.getI18nInstance().changeLanguage(t);var t},children:Bt[e][e]},e))})]}),s.jsx(E,{size:"sm",variant:"ghost","aria-label":"Settings",icon:s.jsx(Wt,{}),onClick:()=>a(!0)}),s.jsx(E,{size:"sm",variant:"ghost","aria-label":"Help",icon:s.jsx(Dt,{}),onClick:()=>h(!0)})]})]}),s.jsx(Cn,{isOpen:l,onClose:()=>a(!1)}),s.jsx(es,{isOpen:d,onClose:()=>h(!1)})]})}function _n(){const e=we(),t=ye(e=>e.runtime.globalAlerts);return s.jsx(s.Fragment,{children:Object.entries(t).map(([t,{message:n,url:r,linkedApp:i}])=>s.jsxs(T,{status:t,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[s.jsx(L,{}),i?s.jsx(v,{onClick:()=>(e=>{he.isStandaloneWindow()?window.open(`/${e}`,"_blank"):he.openApp({appId:e})})(i),children:n}):r?s.jsx(v,{href:r,target:"_blank",children:n}):n,s.jsx(G,{ml:"auto",onClick:()=>e(Ft(t))})]},t))})}}}});
